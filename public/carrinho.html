<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho - FutWear</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad1' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2316a34a;stop-opacity:1' /><stop offset='100%' style='stop-color:%2315803d;stop-opacity:1' /></linearGradient></defs><circle cx='16' cy='16' r='15' fill='url(%23grad1)' stroke='%23fff' stroke-width='2'/><text x='16' y='22' font-family='Arial, sans-serif' font-size='18' font-weight='bold' text-anchor='middle' fill='white'>F</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <style>
        .cart-page {
            padding: var(--spacing-3xl) 0;
            min-height: 60vh;
        }

        .cart-header {
            margin-bottom: var(--spacing-2xl);
        }

        .cart-header h1 {
            font-size: var(--font-size-3xl);
            font-weight: 700;
        }

        .cart-header p {
            color: var(--color-gray-400);
            margin-top: var(--spacing-sm);
        }

        .cart-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: var(--spacing-2xl);
            align-items: start;
        }

        .cart-items-card {
            border: 1px solid var(--color-gray-100);
            border-radius: 4px;
            background: var(--color-white);
        }

        .cart-item {
            display: flex;
            gap: var(--spacing-lg);
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--color-gray-100);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-category {
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
            margin-bottom: 4px;
        }

        .cart-item-name {
            font-size: var(--font-size-base);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .cart-item-size {
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
            margin-bottom: var(--spacing-md);
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .qty-control {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--color-gray-200);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: var(--color-white);
            transition: all var(--transition-fast);
            font-size: 11px;
        }

        .qty-btn:hover {
            background: var(--color-black);
            color: var(--color-white);
            border-color: var(--color-black);
        }

        .qty-value {
            font-weight: 600;
            width: 24px;
            text-align: center;
        }

        .cart-item-price {
            font-weight: 700;
            color: var(--color-black);
        }

        .cart-item-remove {
            margin-left: auto;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--color-gray-300);
            font-size: var(--font-size-base);
            transition: color var(--transition-fast);
        }

        .cart-item-remove:hover {
            color: #dc2626;
        }

        .cart-empty {
            text-align: center;
            padding: var(--spacing-3xl) var(--spacing-xl);
        }

        .cart-empty i {
            font-size: 4rem;
            color: var(--color-gray-200);
            margin-bottom: var(--spacing-xl);
            display: block;
        }

        .cart-empty h3 {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .cart-empty p {
            color: var(--color-gray-400);
            margin-bottom: var(--spacing-xl);
        }

        .cart-empty a {
            display: inline-block;
            background: var(--color-black);
            color: var(--color-white);
            padding: 12px 28px;
            border-radius: 30px;
            font-weight: 500;
            text-decoration: none;
        }

        .cart-summary-card {
            border: 1px solid var(--color-gray-100);
            border-radius: 4px;
            padding: var(--spacing-xl);
            background: var(--color-white);
            position: sticky;
            top: calc(var(--header-height) + var(--spacing-xl));
        }

        .cart-summary-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-xl);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-sm);
        }

        .summary-row.total {
            border-top: 1px solid var(--color-gray-100);
            padding-top: var(--spacing-md);
            margin-top: var(--spacing-md);
            font-size: var(--font-size-base);
            font-weight: 700;
        }

        .summary-shipping-free {
            color: #16a34a;
            font-weight: 600;
        }

        .coupon-input {
            display: flex;
            gap: var(--spacing-sm);
            margin: var(--spacing-xl) 0;
        }

        .coupon-input input {
            flex: 1;
            padding: 10px var(--spacing-md);
            border: 1px solid var(--color-gray-200);
            border-radius: 4px;
            font-family: var(--font-primary);
            font-size: var(--font-size-sm);
            outline: none;
        }

        .coupon-input input:focus {
            border-color: var(--color-black);
        }

        .coupon-input button {
            padding: 10px var(--spacing-md);
            background: var(--color-black);
            color: var(--color-white);
            border: none;
            border-radius: 4px;
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            font-family: var(--font-primary);
        }

        .btn-checkout {
            width: 100%;
            padding: 16px;
            background: var(--color-black);
            color: var(--color-white);
            border: none;
            border-radius: 4px;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-primary);
            transition: opacity var(--transition-fast);
        }

        .btn-checkout:hover {
            opacity: 0.85;
        }

        .btn-clear {
            width: 100%;
            padding: 12px;
            background: var(--color-white);
            color: #dc2626;
            border: 1px solid #fecaca;
            border-radius: 4px;
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            font-family: var(--font-primary);
            transition: all var(--transition-fast);
        }

        .btn-clear:hover {
            background: #fef2f2;
        }

        .cart-continues {
            display: block;
            text-align: center;
            margin-top: var(--spacing-md);
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
        }

        .summary-trust {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-xl);
            font-size: var(--font-size-xs);
            color: var(--color-gray-400);
        }

        .personalization-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: var(--font-size-xs);
            color: #15803d;
            margin-bottom: var(--spacing-sm);
        }

        @media (max-width: 960px) {
            .cart-layout {
                grid-template-columns: 1fr;
            }

            .cart-summary-card {
                position: static;
            }
        }

        @media (max-width: 640px) {
            .cart-header h1 {
                font-size: var(--font-size-2xl);
            }

            .cart-item {
                flex-wrap: wrap;
            }

            .cart-item-img {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-top-content">
                    <div class="header-logo">
                        <a href="index.html"><span class="logo-text">FUT<span class="logo-accent">WEAR</span></span></a>
                    </div>
                    <nav class="header-nav">
                        <a href="camisas.html" class="nav-link">Novidades</a>
                        <a href="camisas.html?category=clubs" class="nav-link">Times</a>
                        <a href="camisas.html?category=national" class="nav-link">Seleções</a>
                        <a href="camisas.html?category=retro" class="nav-link">Retrô</a>
                        <a href="camisas.html?discount=true" class="nav-link">Ofertas</a>
                    </nav>
                    <div class="header-actions">
                        <div class="search-container">
                            <button class="search-btn" id="searchToggle" aria-label="Buscar"><i
                                    class="fas fa-search"></i></button>
                        </div>
                        <a href="favoritos.html" class="icon-btn" aria-label="Favoritos">
                            <i class="far fa-heart"></i>
                            <span class="badge" id="wishlistBadge">0</span>
                        </a>
                        <a href="carrinho.html" class="icon-btn" aria-label="Carrinho">
                            <i class="fas fa-shopping-bag"></i>
                            <span class="badge" id="cartBadge">0</span>
                        </a>
                        <a href="perfil.html" class="icon-btn auth-avatar" id="profileLink" aria-label="Perfil">
                            <span id="authAvatar"><i class="far fa-user"></i></span>
                        </a>
                        <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Overlay -->
    <div class="search-box" id="searchBox">
        <div class="search-box-inner">
            <button class="search-close" id="searchClose" aria-label="Fechar busca"><i
                    class="fas fa-times"></i></button>
            <input type="text" placeholder="Pesquisar times, seleções, camisas..." class="search-input" id="searchInput"
                autocomplete="off">
            <div class="search-hint">
                <span>Sugestões:</span>
                <a href="camisas.html?category=clubs">Times</a>
                <a href="camisas.html?category=national">Seleções</a>
                <a href="camisas.html?category=retro">Retrô</a>
                <a href="camisas.html?discount=true">Ofertas</a>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <button class="mobile-menu-close" id="mobileMenuClose"><i class="fas fa-times"></i></button>
            <nav class="mobile-nav">
                <a href="camisas.html" class="mobile-nav-link">Novidades</a>
                <a href="camisas.html?category=clubs" class="mobile-nav-link">Times</a>
                <a href="camisas.html?category=national" class="mobile-nav-link">Seleções</a>
                <a href="camisas.html?category=retro" class="mobile-nav-link">Retrô</a>
                <a href="camisas.html?discount=true" class="mobile-nav-link">Ofertas</a>
            </nav>
        </div>
    </div>

    <!-- Cart Page -->
    <main class="cart-page">
        <div class="container">
            <div class="cart-header">
                <h1>Carrinho de Compras</h1>
                <p>Você tem <span id="cart-items-count" style="font-weight:600;">0 itens</span> no seu carrinho</p>
            </div>

            <div class="cart-layout" id="cart-layout-grid">
                <!-- Cart Items -->
                <div class="cart-items-card" id="cart-items-container">
                    <div class="cart-empty">
                        <i class="fas fa-shopping-bag"></i>
                        <h3>Seu carrinho está vazio</h3>
                        <p>Adicione produtos para começar a comprar!</p>
                        <a href="camisas.html"><i class="fas fa-shopping-bag" style="margin-right:.5rem;"></i>Explorar
                            Camisas</a>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="cart-summary-card">
                    <h2 class="cart-summary-title">Resumo do Pedido</h2>
                    <div class="summary-row">
                        <span>Subtotal (<span id="summary-items-count">0</span> itens)</span>
                        <span id="summary-subtotal">R$ 0,00</span>
                    </div>
                    <div class="summary-row">
                        <span>Frete</span>
                        <span id="summary-shipping">R$ 0,00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span id="summary-total">R$ 0,00</span>
                    </div>
                    <div class="coupon-input">
                        <input type="text" id="coupon-code" placeholder="Código de cupom">
                        <button id="apply-coupon">Aplicar</button>
                    </div>
                    <button class="btn-checkout" onclick="window.proceedToCheckout()">
                        <i class="fas fa-lock" style="margin-right:.5rem;"></i>Finalizar Compra
                    </button>
                    <button class="btn-clear" onclick="window.clearCart()">
                        <i class="fas fa-trash" style="margin-right:.5rem;"></i>Limpar Carrinho
                    </button>
                    <a href="camisas.html" class="cart-continues">← Continuar Comprando</a>
                    <div class="summary-trust">
                        <i class="fas fa-lock"></i>
                        <span>Compra 100% Segura</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4 class="footer-title">Encontre uma Loja</h4>
                    <ul class="footer-links">
                        <li><a href="#">Seja um Membro</a></li>
                        <li><a href="#">Cadastre seu E-mail</a></li>
                        <li><a href="#">Envie sua Opinião</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-title">Obter Ajuda</h4>
                    <ul class="footer-links">
                        <li><a href="#">Status do Pedido</a></li>
                        <li><a href="#">Entrega</a></li>
                        <li><a href="#">Devoluções</a></li>
                        <li><a href="#">Contato</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-title">Sobre a FutWear</h4>
                    <ul class="footer-links">
                        <li><a href="#">Notícias</a></li>
                        <li><a href="#">Carreiras</a></li>
                        <li><a href="#">Sustentabilidade</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <div class="social-links">
                        <a href="#" class="social-btn"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-btn"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-btn"><i class="fab fa-youtube"></i></a>
                        <a href="#" class="social-btn"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-bottom-left">
                    <p><i class="fas fa-map-marker-alt"></i> Brasil</p>
                    <p>© 2024 FutWear, Inc. Todos os direitos reservados.</p>
                </div>
                <div class="footer-bottom-right">
                    <a href="#">Termos de Uso</a>
                    <a href="#">Política de Privacidade</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="header.js"></script>
    <script type="module">
        import { getCart, setCart, atualizarIconeCarrinho } from './firebase-hybrid.js';
        window.atualizarIconeCarrinho = atualizarIconeCarrinho;

        document.addEventListener('DOMContentLoaded', function () {
            loadCart();
            atualizarIconeCarrinho();
            setupCouponCode();
            window.addEventListener('storage', function (e) {
                if (e.key === 'cart') { loadCart(); atualizarIconeCarrinho(); }
            });
            window.addEventListener('cartUpdated', function () { loadCart(); atualizarIconeCarrinho(); });
        });

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `position:fixed;top:100px;right:20px;z-index:9999;padding:12px 20px;border-radius:4px;color:white;font-size:14px;font-family:var(--font-primary);animation:fadeInRight .3s ease;`;
            if (type === 'success') toast.style.background = '#16a34a';
            else if (type === 'error') toast.style.background = '#dc2626';
            else toast.style.background = '#111';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => { if (document.body.contains(toast)) document.body.removeChild(toast); }, 3000);
        }

        async function loadCart() {
            try {
                const cart = await getCart();
                if (!cart || cart.length === 0) { renderCartItems([]); updateOrderSummary([]); return; }
                renderCartItems(cart);
                updateOrderSummary(cart);
            } catch (error) {
                console.error('Erro ao carregar carrinho:', error);
                const fallbackCart = JSON.parse(localStorage.getItem('cart') || '[]');
                renderCartItems(fallbackCart);
                updateOrderSummary(fallbackCart);
            }
        }

        function renderCartItems(cart) {
            const container = document.getElementById('cart-items-container');
            if (!container) return;
            if (!cart || cart.length === 0) {
                container.innerHTML = `
                    <div class="cart-empty">
                        <i class="fas fa-shopping-bag"></i>
                        <h3>Seu carrinho está vazio</h3>
                        <p>Adicione produtos para começar a comprar!</p>
                        <a href="camisas.html"><i class="fas fa-shopping-bag" style="margin-right:.5rem;"></i>Explorar Camisas</a>
                    </div>`;
                return;
            }
            container.innerHTML = cart.map((item, index) => `
                <div class="cart-item">
                    <img src="${item.image || 'https://images.unsplash.com/photo-1614624532983-4fe0333299c7?w=200'}" alt="${item.name}" class="cart-item-img">
                    <div class="cart-item-info">
                        <p class="cart-item-category">${item.team || item.category || ''}</p>
                        <h3 class="cart-item-name">${item.name}</h3>
                        <p class="cart-item-size">Tamanho: ${item.size || 'N/A'}</p>
                        ${item.personalization && item.personalization.enabled ? `
                        <div class="personalization-tag">
                            <i class="fas fa-paint-brush"></i> Personalização
                            ${item.personalization.name ? `<span>Nome: <b>${item.personalization.name}</b></span>` : ''}
                            ${item.personalization.number ? `<span>Nº: <b>${item.personalization.number}</b></span>` : ''}
                        </div>` : ''}
                        <div class="cart-item-actions">
                            <div class="qty-control">
                                <button class="qty-btn" onclick="window.handleQuantityChange(${index}, -1)"><i class="fas fa-minus"></i></button>
                                <span class="qty-value">${item.quantity || 1}</span>
                                <button class="qty-btn" onclick="window.handleQuantityChange(${index}, 1)"><i class="fas fa-plus"></i></button>
                            </div>
                            <span class="cart-item-price">R$ ${(((Number(item.price) || 0) + (item.personalization?.enabled ? Number(item.personalization.fee || 0) : 0)) * (item.quantity || 1)).toFixed(2).replace('.', ',')}</span>
                            <button class="cart-item-remove" onclick="window.handleRemoveItem(${index})" title="Remover"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>`).join('');
        }

        function setupCouponCode() {
            const applyBtn = document.getElementById('apply-coupon');
            if (applyBtn) { applyBtn.addEventListener('click', () => { alert('Cupom inválido'); }); }
        }

        window.proceedToCheckout = function () {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            if (cart.length === 0) { showToast('Seu carrinho está vazio', 'error'); return; }
            window.location.href = 'checkout.html';
        };

        window.clearCart = function () {
            if (confirm('Tem certeza que deseja limpar o carrinho?')) { setCart([]); localStorage.setItem('cart', '[]'); loadCart(); atualizarIconeCarrinho(); }
        };

        window.handleQuantityChange = async function (index, change) {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            if (cart[index]) {
                cart[index].quantity = (cart[index].quantity || 1) + change;
                if (cart[index].quantity < 1) cart[index].quantity = 1;
                setCart(cart); loadCart();
            }
        };

        window.handleRemoveItem = function (index) {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            cart.splice(index, 1); setCart(cart); loadCart();
        };

        function updateOrderSummary(cart) {
            const subtotal = cart.reduce((acc, item) => acc + (((Number(item.price) || 0) + (item.personalization?.enabled ? Number(item.personalization.fee || 0) : 0)) * (item.quantity || 1)), 0);
            const count = cart.reduce((acc, item) => acc + (item.quantity || 1), 0);
            let shippingCost = 0;
            if (count === 1) shippingCost = 30;
            else if (count === 2) shippingCost = 20;
            const total = subtotal + shippingCost;

            document.getElementById('summary-items-count').textContent = count;
            document.getElementById('cart-items-count').textContent = count + (count === 1 ? ' item' : ' itens');
            document.getElementById('summary-subtotal').textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
            const shippingEl = document.getElementById('summary-shipping');
            if (shippingCost === 0 && count > 0) { shippingEl.textContent = 'Grátis'; shippingEl.style.color = '#16a34a'; shippingEl.style.fontWeight = '600'; }
            else { shippingEl.textContent = count === 0 ? 'R$ 0,00' : `R$ ${shippingCost.toFixed(2).replace('.', ',')}`; shippingEl.style.color = ''; shippingEl.style.fontWeight = ''; }
            document.getElementById('summary-total').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            const badge = document.getElementById('cartBadge');
            if (badge) { badge.textContent = count; }
        }
    </script>
</body>

</html>