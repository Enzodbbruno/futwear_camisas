<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produto - FutWear</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad1' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2316a34a;stop-opacity:1' /><stop offset='100%' style='stop-color:%2315803d;stop-opacity:1' /></linearGradient></defs><circle cx='16' cy='16' r='15' fill='url(%23grad1)' stroke='%23fff' stroke-width='2'/><text x='16' y='22' font-family='Arial, sans-serif' font-size='18' font-weight='bold' text-anchor='middle' fill='white'>F</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <style>
        .breadcrumb {
            padding: var(--spacing-lg) 0;
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
        }

        .breadcrumb a {
            color: var(--color-gray-400);
            transition: color var(--transition-fast);
        }

        .breadcrumb a:hover {
            color: var(--color-black);
        }

        .breadcrumb span {
            margin: 0 var(--spacing-sm);
        }

        .product-detail {
            padding: var(--spacing-2xl) 0 var(--spacing-4xl);
        }

        .product-layout {
            display: grid;
            grid-template-columns: 60% 40%;
            gap: var(--spacing-3xl);
        }

        .product-gallery {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: var(--spacing-sm);
        }

        .gallery-thumbnails {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .gallery-thumb {
            aspect-ratio: 1;
            background: var(--color-gray-50);
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color var(--transition-fast);
        }

        .gallery-thumb.active,
        .gallery-thumb:hover {
            border-color: var(--color-black);
        }

        .gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-main {
            aspect-ratio: 1;
            background: var(--color-gray-50);
            overflow: hidden;
        }

        .gallery-main img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-detail-info {
            position: sticky;
            top: calc(var(--header-height) + var(--spacing-xl));
            height: fit-content;
        }

        .product-detail-category {
            font-size: var(--font-size-base);
            color: var(--color-accent);
            font-weight: 500;
            margin-bottom: var(--spacing-sm);
        }

        .product-detail-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            line-height: 1.2;
        }

        .product-detail-subtitle {
            font-size: var(--font-size-base);
            color: var(--color-gray-400);
            margin-bottom: var(--spacing-xl);
        }

        .product-prices {
            margin-bottom: var(--spacing-2xl);
        }

        .product-original-price {
            text-decoration: line-through;
            color: var(--color-gray-300);
            font-size: var(--font-size-base);
            margin-bottom: 4px;
        }

        .product-price-main {
            font-size: var(--font-size-xl);
            font-weight: 700;
        }

        .product-installment {
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
            margin-top: 4px;
        }

        .size-selector {
            margin-bottom: var(--spacing-2xl);
        }

        .size-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            font-weight: 500;
        }

        .size-guide {
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            font-family: var(--font-primary);
        }

        .size-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing-sm);
        }

        .size-option {
            aspect-ratio: 1;
            border: 1px solid var(--color-gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            background: var(--color-white);
            font-family: var(--font-primary);
            font-size: var(--font-size-sm);
        }

        .size-option:hover {
            border-color: var(--color-black);
        }

        .size-option.selected {
            border-color: var(--color-black);
            border-width: 2px;
        }

        .size-option.unavailable {
            opacity: 0.3;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .product-actions {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-2xl);
        }

        .btn-add-cart {
            padding: 18px 24px;
            background: var(--color-black);
            color: var(--color-white);
            border-radius: 30px;
            font-size: var(--font-size-base);
            font-weight: 500;
            transition: all var(--transition-base);
            cursor: pointer;
            border: none;
            font-family: var(--font-primary);
        }

        .btn-add-cart:hover {
            background: var(--color-gray-500);
        }

        .btn-add-cart:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-favorite {
            padding: 18px 24px;
            background: var(--color-white);
            color: var(--color-black);
            border: 1px solid var(--color-gray-200);
            border-radius: 30px;
            font-size: var(--font-size-base);
            font-weight: 500;
            transition: all var(--transition-base);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            font-family: var(--font-primary);
        }

        .btn-favorite:hover,
        .btn-favorite.active {
            border-color: var(--color-black);
        }

        .btn-favorite.active i {
            color: #dc2626;
            font-weight: 900;
        }

        .product-features {
            border-top: 1px solid var(--color-gray-100);
            padding-top: var(--spacing-xl);
        }

        .feature-item {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--color-gray-100);
            cursor: pointer;
            align-items: center;
            justify-content: space-between;
        }

        .feature-item:last-child {
            border-bottom: none;
        }

        .feature-title {
            font-weight: 500;
        }

        .personalization-section {
            border: 1px solid var(--color-gray-100);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
        }

        .personalization-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .personalization-toggle h3 {
            font-weight: 600;
            font-size: var(--font-size-base);
        }

        .personalization-fields {
            margin-top: var(--spacing-lg);
            display: none;
        }

        .personalization-fields.open {
            display: block;
        }

        .pers-input {
            width: 100%;
            padding: 10px var(--spacing-md);
            border: 1px solid var(--color-gray-200);
            border-radius: 4px;
            font-family: var(--font-primary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-md);
            outline: none;
            box-sizing: border-box;
        }

        .pers-input:focus {
            border-color: var(--color-black);
        }

        @media (max-width: 960px) {
            .product-layout {
                grid-template-columns: 1fr;
            }

            .product-gallery {
                grid-template-columns: 1fr;
            }

            .gallery-thumbnails {
                flex-direction: row;
            }

            .product-detail-info {
                position: static;
            }
        }

        @media (max-width: 640px) {
            .product-detail-title {
                font-size: var(--font-size-xl);
            }

            .size-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-top-content">
                    <div class="header-logo">
                        <a href="index.html"><span class="logo-text">FUT<span class="logo-accent">WEAR</span></span></a>
                    </div>
                    <nav class="header-nav">
                        <a href="camisas.html" class="nav-link">Novidades</a>
                        <a href="camisas.html?category=clubs" class="nav-link">Times</a>
                        <a href="camisas.html?category=national" class="nav-link">Seleções</a>
                        <a href="camisas.html?category=retro" class="nav-link">Retrô</a>
                        <a href="camisas.html?discount=true" class="nav-link">Ofertas</a>
                    </nav>
                    <div class="header-actions">
                        <div class="search-container">
                            <button class="search-btn" id="searchToggle" aria-label="Buscar"><i
                                    class="fas fa-search"></i></button>
                        </div>
                        <a href="favoritos.html" class="icon-btn" aria-label="Favoritos">
                            <i class="far fa-heart"></i>
                            <span class="badge" id="wishlistBadge">0</span>
                        </a>
                        <a href="carrinho.html" class="icon-btn" aria-label="Carrinho">
                            <i class="fas fa-shopping-bag"></i>
                            <span class="badge" id="cartBadge">0</span>
                        </a>
                        <a href="perfil.html" class="icon-btn auth-avatar" id="profileLink" aria-label="Perfil">
                            <span id="authAvatar"><i class="far fa-user"></i></span>
                        </a>
                        <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Overlay -->
    <div class="search-box" id="searchBox">
        <div class="search-box-inner">
            <button class="search-close" id="searchClose" aria-label="Fechar busca"><i
                    class="fas fa-times"></i></button>
            <input type="text" placeholder="Pesquisar times, seleções, camisas..." class="search-input" id="searchInput"
                autocomplete="off">
            <div class="search-hint">
                <span>Sugestões:</span>
                <a href="camisas.html?category=clubs">Times</a>
                <a href="camisas.html?category=national">Seleções</a>
                <a href="camisas.html?category=retro">Retrô</a>
                <a href="camisas.html?discount=true">Ofertas</a>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <button class="mobile-menu-close" id="mobileMenuClose"><i class="fas fa-times"></i></button>
            <nav class="mobile-nav">
                <a href="camisas.html" class="mobile-nav-link">Novidades</a>
                <a href="camisas.html?category=clubs" class="mobile-nav-link">Times</a>
                <a href="camisas.html?category=national" class="mobile-nav-link">Seleções</a>
                <a href="camisas.html?category=retro" class="mobile-nav-link">Retrô</a>
                <a href="camisas.html?discount=true" class="mobile-nav-link">Ofertas</a>
            </nav>
        </div>
    </div>

    <!-- Breadcrumb -->
    <div class="breadcrumb-container">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html">Início</a>
                <span>/</span>
                <a href="camisas.html">Camisas</a>
                <span>/</span>
                <span id="breadcrumb-product">Produto</span>
            </div>
        </div>
    </div>

    <!-- Product Detail -->
    <section class="product-detail">
        <div class="container">
            <!-- Loading State -->
            <div id="product-loading" style="text-align:center; padding: 80px 0; color: var(--color-gray-400);">
                <i class="fas fa-spinner fa-spin"
                    style="font-size: 3rem; display:block; margin-bottom: 1.5rem; color:#ccc;"></i>
                <p>Carregando produto...</p>
            </div>

            <!-- Product Content -->
            <div class="product-layout" id="product-content" style="display:none;">
                <!-- Gallery -->
                <div class="product-gallery">
                    <div class="gallery-thumbnails" id="galleryThumbs">
                        <div class="gallery-thumb active" onclick="changeMainImage(0)">
                            <img id="thumb-0" src="https://images.unsplash.com/photo-1614624532983-4fe0333299c7?w=200"
                                alt="Imagem 1">
                        </div>
                        <div class="gallery-thumb" onclick="changeMainImage(1)">
                            <img id="thumb-1" src="https://images.unsplash.com/photo-1543357480-c60d400e8073?w=200"
                                alt="Imagem 2">
                        </div>
                        <div class="gallery-thumb" onclick="changeMainImage(2)">
                            <img id="thumb-2" src="https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=200"
                                alt="Imagem 3">
                        </div>
                    </div>
                    <div class="gallery-main">
                        <img id="mainImage" src="https://images.unsplash.com/photo-1614624532983-4fe0333299c7?w=800"
                            alt="Produto">
                    </div>
                </div>

                <!-- Info -->
                <div class="product-detail-info">
                    <p class="product-detail-category" id="product-team">Carregando...</p>
                    <h1 class="product-detail-title" id="product-name">Carregando...</h1>
                    <p class="product-detail-subtitle" id="product-description">Carregando...</p>

                    <div class="product-prices">
                        <p class="product-original-price" id="product-original-price" style="display:none;"></p>
                        <p class="product-price-main" id="product-price">R$ 0,00</p>
                        <p class="product-installment" id="product-installment"></p>
                    </div>

                    <!-- Size Selector -->
                    <div class="size-selector">
                        <div class="size-label">
                            <span>Selecione o Tamanho</span>
                            <button class="size-guide">Guia de Tamanhos</button>
                        </div>
                        <div class="size-grid" id="size-grid">
                            <button class="size-option" onclick="selectSize(this, 'PP')">PP</button>
                            <button class="size-option" onclick="selectSize(this, 'P')">P</button>
                            <button class="size-option" onclick="selectSize(this, 'M')">M</button>
                            <button class="size-option" onclick="selectSize(this, 'G')">G</button>
                            <button class="size-option" onclick="selectSize(this, 'GG')">GG</button>
                            <button class="size-option" onclick="selectSize(this, 'XGG')">XGG</button>
                        </div>
                    </div>

                    <!-- Personalization -->
                    <div class="personalization-section" id="personalization-section" style="display:none;">
                        <div class="personalization-toggle" onclick="togglePersonalization()">
                            <h3><i class="fas fa-paint-brush"
                                    style="margin-right:.5rem; color: #16a34a;"></i>Personalizar Camisa <small
                                    style="font-size:12px; color:#888;">(+R$ 30,00)</small></h3>
                            <i class="fas fa-chevron-down" id="pers-arrow"></i>
                        </div>
                        <div class="personalization-fields" id="pers-fields">
                            <input type="text" class="pers-input" id="pers-name" placeholder="Nome (máx. 12 caracteres)"
                                maxlength="12">
                            <input type="number" class="pers-input" id="pers-number" placeholder="Número (0-99)" min="0"
                                max="99">
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="product-actions">
                        <button class="btn-add-cart" id="btn-add-cart" onclick="addProductToCart()">
                            <i class="fas fa-shopping-bag" style="margin-right:.5rem;"></i>Adicionar ao Carrinho
                        </button>
                        <button class="btn-favorite" id="btn-favorite" onclick="toggleFavoriteBtn()">
                            <i class="far fa-heart"></i>
                            <span>Adicionar aos Favoritos</span>
                        </button>
                    </div>

                    <!-- Product Features -->
                    <div class="product-features">
                        <div class="feature-item">
                            <span class="feature-title"><i class="fas fa-truck"
                                    style="margin-right:.5rem;"></i>Entrega</span>
                            <span style="font-size:var(--font-size-sm); color:var(--color-gray-400);">Frete grátis acima
                                de 3 itens</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-title"><i class="fas fa-undo"
                                    style="margin-right:.5rem;"></i>Devoluções</span>
                            <span style="font-size:var(--font-size-sm); color:var(--color-gray-400);">30 dias para
                                devolver</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-title"><i class="fas fa-shield-alt"
                                    style="margin-right:.5rem;"></i>Autenticidade</span>
                            <span style="font-size:var(--font-size-sm); color:var(--color-gray-400);">100% produto
                                original</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error State -->
            <div id="product-error" style="display:none; text-align:center; padding: 80px 0;">
                <i class="fas fa-exclamation-circle"
                    style="font-size:3rem; color:#ccc; display:block; margin-bottom:1rem;"></i>
                <h2 style="margin-bottom:.5rem;">Produto não encontrado</h2>
                <p style="color:var(--color-gray-400); margin-bottom:2rem;">Este produto não existe ou foi removido.</p>
                <a href="camisas.html" class="btn btn-primary">Ver Todas as Camisas</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4 class="footer-title">Encontre uma Loja</h4>
                    <ul class="footer-links">
                        <li><a href="#">Seja um Membro</a></li>
                        <li><a href="#">Cadastre seu E-mail</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-title">Obter Ajuda</h4>
                    <ul class="footer-links">
                        <li><a href="#">Status do Pedido</a></li>
                        <li><a href="#">Entrega</a></li>
                        <li><a href="#">Devoluções</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-title">Sobre a FutWear</h4>
                    <ul class="footer-links">
                        <li><a href="#">Notícias</a></li>
                        <li><a href="#">Carreiras</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <div class="social-links">
                        <a href="#" class="social-btn"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-btn"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-btn"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-bottom-left">
                    <p><i class="fas fa-map-marker-alt"></i> Brasil</p>
                    <p>© 2024 FutWear, Inc. Todos os direitos reservados.</p>
                </div>
                <div class="footer-bottom-right">
                    <a href="#">Termos de Uso</a>
                    <a href="#">Política de Privacidade</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="header.js"></script>
    <script type="module">
        import { getProductById, addToCart } from './firebase-hybrid.js';

        let currentProduct = null;
        let selectedSize = null;

        window.selectSize = function (btn, size) {
            document.querySelectorAll('.size-option').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedSize = size;
        };

        window.changeMainImage = function (index) {
            const thumbs = document.querySelectorAll('.gallery-thumb');
            thumbs.forEach(t => t.classList.remove('active'));
            thumbs[index]?.classList.add('active');
            const thumb = document.getElementById(`thumb-${index}`);
            if (thumb) document.getElementById('mainImage').src = thumb.src.replace('w=200', 'w=800');
        };

        window.togglePersonalization = function () {
            const fields = document.getElementById('pers-fields');
            const arrow = document.getElementById('pers-arrow');
            fields.classList.toggle('open');
            arrow.style.transform = fields.classList.contains('open') ? 'rotate(180deg)' : '';
        };

        window.addProductToCart = function () {
            if (!currentProduct) return;
            if (!selectedSize) {
                showToast('Selecione um tamanho', 'error'); return;
            }
            const persName = document.getElementById('pers-name').value.trim();
            const persNumber = document.getElementById('pers-number').value.trim();
            const persEnabled = persName || persNumber;

            addToCart({
                ...currentProduct,
                size: selectedSize,
                personalization: persEnabled ? { enabled: true, name: persName, number: persNumber, fee: 30 } : { enabled: false }
            });
            showToast('Produto adicionado ao carrinho!', 'success');

            const badge = document.getElementById('cartBadge');
            if (badge) {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                badge.textContent = cart.reduce((s, i) => s + (i.quantity || 1), 0);
            }
        };

        window.toggleFavoriteBtn = function () {
            if (!currentProduct) return;
            if (window.toggleFavorite) window.toggleFavorite(currentProduct);
            const btn = document.getElementById('btn-favorite');
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            const isNowFav = icon.classList.toggle('fas');
            icon.classList.toggle('far');
            btn.classList.toggle('active', isNowFav);
            text.textContent = isNowFav ? 'Remover dos Favoritos' : 'Adicionar aos Favoritos';
        };

        function showToast(msg, type = 'info') {
            const t = document.createElement('div');
            t.style.cssText = `position:fixed;top:100px;right:20px;z-index:9999;padding:12px 20px;border-radius:4px;color:white;font-size:14px;font-family:var(--font-primary);`;
            t.style.background = type === 'success' ? '#16a34a' : type === 'error' ? '#dc2626' : '#111';
            t.textContent = msg;
            document.body.appendChild(t);
            setTimeout(() => { if (document.body.contains(t)) document.body.removeChild(t); }, 3000);
        }

        async function loadProduct() {
            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id');

            if (!productId) {
                document.getElementById('product-loading').style.display = 'none';
                document.getElementById('product-error').style.display = 'block';
                return;
            }

            try {
                const product = await getProductById(productId);
                if (!product) {
                    document.getElementById('product-loading').style.display = 'none';
                    document.getElementById('product-error').style.display = 'block';
                    return;
                }
                currentProduct = product;
                renderProduct(product);
            } catch (err) {
                console.error('Erro ao carregar produto:', err);
                document.getElementById('product-loading').style.display = 'none';
                document.getElementById('product-error').style.display = 'block';
            }
        }

        function renderProduct(p) {
            document.title = `${p.name} - FutWear`;
            document.getElementById('breadcrumb-product').textContent = p.name;
            document.getElementById('product-team').textContent = p.team || p.category || '';
            document.getElementById('product-name').textContent = p.name;
            document.getElementById('product-description').textContent = p.description || 'Camisa oficial com qualidade premium e autenticidade garantida.';

            const price = Number(p.price) || 0;
            const originalPrice = Number(p.original_price || p.originalPrice) || 0;
            if (originalPrice > price) {
                document.getElementById('product-original-price').textContent = `R$ ${originalPrice.toFixed(2).replace('.', ',')}`;
                document.getElementById('product-original-price').style.display = 'block';
            }
            document.getElementById('product-price').textContent = `R$ ${price.toFixed(2).replace('.', ',')}`;
            document.getElementById('product-installment').textContent = `ou 3x de R$ ${(price / 3).toFixed(2).replace('.', ',')} sem juros`;

            // Images
            const images = p.images || (p.image ? [p.image] : []);
            if (images.length > 0) {
                document.getElementById('mainImage').src = images[0];
                for (let i = 0; i < Math.min(images.length, 3); i++) {
                    const thumb = document.getElementById(`thumb-${i}`);
                    if (thumb) thumb.src = images[i];
                }
            }

            // Personalization
            if (p.allowPersonalization || p.personalization) {
                document.getElementById('personalization-section').style.display = 'block';
            }

            document.getElementById('product-loading').style.display = 'none';
            document.getElementById('product-content').style.display = 'grid';
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadProduct();
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const badge = document.getElementById('cartBadge');
            if (badge) badge.textContent = cart.reduce((s, i) => s + (i.quantity || 1), 0);
        });
    </script>
</body>

</html>