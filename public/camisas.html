<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todas as Camisas - FutWear</title>
    <meta name="description"
        content="Encontre camisas dos maiores times e seleções do mundo na FutWear. Autenticidade garantida.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad1' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2316a34a;stop-opacity:1' /><stop offset='100%' style='stop-color:%2315803d;stop-opacity:1' /></linearGradient></defs><circle cx='16' cy='16' r='15' fill='url(%23grad1)' stroke='%23fff' stroke-width='2'/><text x='16' y='22' font-family='Arial, sans-serif' font-size='18' font-weight='bold' text-anchor='middle' fill='white'>F</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <style>
        .page-header {
            padding: var(--spacing-3xl) 0 var(--spacing-2xl);
            border-bottom: 1px solid var(--color-gray-100);
        }

        .page-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }

        .page-subtitle {
            font-size: var(--font-size-lg);
            color: var(--color-gray-400);
        }

        .filters-bar {
            padding: var(--spacing-xl) 0;
            border-bottom: 1px solid var(--color-gray-100);
            position: sticky;
            top: var(--header-height);
            background: var(--color-white);
            z-index: 100;
        }

        .filters-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .filters-left {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--color-gray-200);
            border-radius: 20px;
            font-size: var(--font-size-sm);
            font-weight: 500;
            background: var(--color-white);
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .filter-btn:hover {
            border-color: var(--color-black);
        }

        .filter-btn.active {
            background: var(--color-black);
            color: var(--color-white);
            border-color: var(--color-black);
        }

        .sort-select {
            padding: 8px 16px;
            border: 1px solid var(--color-gray-200);
            border-radius: 20px;
            font-size: var(--font-size-sm);
            font-weight: 500;
            background: var(--color-white);
            cursor: pointer;
            outline: none;
            font-family: var(--font-primary);
        }

        .products-grid {
            padding: var(--spacing-2xl) 0;
        }

        .products-count {
            margin-bottom: var(--spacing-xl);
            font-size: var(--font-size-base);
            color: var(--color-gray-400);
        }

        .grid-products {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-xl) var(--spacing-md);
        }

        .load-more {
            text-align: center;
            padding: var(--spacing-3xl) 0;
        }

        .btn-load-more {
            padding: 12px 32px;
            border: 1px solid var(--color-gray-200);
            border-radius: 30px;
            font-size: var(--font-size-base);
            font-weight: 500;
            background: var(--color-white);
            transition: all var(--transition-base);
            cursor: pointer;
            font-family: var(--font-primary);
        }

        .btn-load-more:hover {
            background: var(--color-black);
            color: var(--color-white);
            border-color: var(--color-black);
        }

        @media (max-width: 960px) {
            .grid-products {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .page-title {
                font-size: var(--font-size-2xl);
            }

            .grid-products {
                grid-template-columns: 1fr;
            }

            .filters-content {
                flex-direction: column;
                align-items: stretch;
            }

            .filters-left {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: var(--spacing-sm);
            }

            .filter-btn {
                white-space: nowrap;
            }
        }
    </style>
</head>

<body>
    <!-- Announcement Bar -->
    <div class="announcement-bar">
        <span><span class="ann-dot"></span> Frete Grátis em compras acima de 3 camisas! <span
                class="ann-dot"></span></span>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-top-content">
                    <div class="header-logo">
                        <a href="index.html"><span class="logo-text">FUT<span class="logo-accent">WEAR</span></span></a>
                    </div>
                    <nav class="header-nav">
                        <a href="camisas.html" class="nav-link">Novidades</a>
                        <a href="camisas.html?category=clubs" class="nav-link">Times</a>
                        <a href="camisas.html?category=national" class="nav-link">Seleções</a>
                        <a href="camisas.html?category=retro" class="nav-link">Retrô</a>
                        <a href="camisas.html?discount=true" class="nav-link">Ofertas</a>
                    </nav>
                    <div class="header-actions">
                        <div class="search-container">
                            <button class="search-btn" id="searchToggle" aria-label="Buscar"><i
                                    class="fas fa-search"></i></button>
                        </div>
                        <a href="favoritos.html" class="icon-btn" aria-label="Favoritos">
                            <i class="far fa-heart"></i>
                            <span class="badge" id="wishlistBadge">0</span>
                        </a>
                        <a href="carrinho.html" class="icon-btn" aria-label="Carrinho">
                            <i class="fas fa-shopping-bag"></i>
                            <span class="badge" id="cartBadge">0</span>
                        </a>
                        <a href="perfil.html" class="icon-btn auth-avatar" id="profileLink" aria-label="Perfil">
                            <span id="authAvatar"><i class="far fa-user"></i></span>
                        </a>
                        <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Overlay -->
    <div class="search-box" id="searchBox">
        <div class="search-box-inner">
            <button class="search-close" id="searchClose" aria-label="Fechar busca"><i
                    class="fas fa-times"></i></button>
            <input type="text" placeholder="Pesquisar times, seleções, camisas..." class="search-input" id="searchInput"
                autocomplete="off">
            <div class="search-hint">
                <span>Sugestões:</span>
                <a href="camisas.html?category=clubs">Times</a>
                <a href="camisas.html?category=national">Seleções</a>
                <a href="camisas.html?category=retro">Retrô</a>
                <a href="camisas.html?discount=true">Ofertas</a>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <button class="mobile-menu-close" id="mobileMenuClose"><i class="fas fa-times"></i></button>
            <nav class="mobile-nav">
                <a href="camisas.html" class="mobile-nav-link">Novidades</a>
                <a href="camisas.html?category=clubs" class="mobile-nav-link">Times</a>
                <a href="camisas.html?category=national" class="mobile-nav-link">Seleções</a>
                <a href="camisas.html?category=retro" class="mobile-nav-link">Retrô</a>
                <a href="camisas.html?discount=true" class="mobile-nav-link">Ofertas</a>
            </nav>
        </div>
    </div>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title">Todas as Camisas</h1>
            <p class="page-subtitle">Camisas autênticas dos maiores times e seleções do mundo</p>
        </div>
    </section>

    <!-- Filters Bar -->
    <div class="filters-bar">
        <div class="container">
            <div class="filters-content">
                <div class="filters-left">
                    <button class="filter-btn active" data-filter="all">Todas</button>
                    <button class="filter-btn" data-filter="clubs">Times</button>
                    <button class="filter-btn" data-filter="national">Seleções</button>
                    <button class="filter-btn" data-filter="retro">Retrô</button>
                    <button class="filter-btn" data-filter="discount">Ofertas</button>
                </div>
                <div class="filters-right">
                    <select class="sort-select" id="sortSelect">
                        <option value="featured">Em Destaque</option>
                        <option value="newest">Mais Recentes</option>
                        <option value="price-low">Menor Preço</option>
                        <option value="price-high">Maior Preço</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Products Grid -->
    <section class="products-grid">
        <div class="container">
            <p class="products-count" id="productsCount">Carregando produtos...</p>
            <div class="grid-products" id="productsGrid">
                <!-- Loading skeletons -->
                <div class="product-card" style="pointer-events:none;">
                    <div class="product-image" style="background:#f0f0f0;"></div>
                    <div style="height:60px;background:#f7f7f7;margin-top:8px;"></div>
                </div>
                <div class="product-card" style="pointer-events:none;">
                    <div class="product-image" style="background:#f0f0f0;"></div>
                    <div style="height:60px;background:#f7f7f7;margin-top:8px;"></div>
                </div>
                <div class="product-card" style="pointer-events:none;">
                    <div class="product-image" style="background:#f0f0f0;"></div>
                    <div style="height:60px;background:#f7f7f7;margin-top:8px;"></div>
                </div>
                <div class="product-card" style="pointer-events:none;">
                    <div class="product-image" style="background:#f0f0f0;"></div>
                    <div style="height:60px;background:#f7f7f7;margin-top:8px;"></div>
                </div>
            </div>
            <div class="load-more" id="loadMoreContainer" style="display:none;">
                <button class="btn-load-more" id="loadMoreBtn">Carregar Mais Produtos</button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4 class="footer-title">Encontre uma Loja</h4>
                    <ul class="footer-links">
                        <li><a href="#">Seja um Membro</a></li>
                        <li><a href="#">Cadastre seu E-mail</a></li>
                        <li><a href="#">Envie sua Opinião</a></li>
                        <li><a href="#">Cupons para Estudantes</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-title">Obter Ajuda</h4>
                    <ul class="footer-links">
                        <li><a href="#">Status do Pedido</a></li>
                        <li><a href="#">Entrega</a></li>
                        <li><a href="#">Devoluções</a></li>
                        <li><a href="#">Opções de Pagamento</a></li>
                        <li><a href="#">Contato</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4 class="footer-title">Sobre a FutWear</h4>
                    <ul class="footer-links">
                        <li><a href="#">Notícias</a></li>
                        <li><a href="#">Carreiras</a></li>
                        <li><a href="#">Investidores</a></li>
                        <li><a href="#">Sustentabilidade</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <div class="social-links">
                        <a href="#" class="social-btn"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-btn"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-btn"><i class="fab fa-youtube"></i></a>
                        <a href="#" class="social-btn"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-bottom-left">
                    <p><i class="fas fa-map-marker-alt"></i> Brasil</p>
                    <p>© 2024 FutWear, Inc. Todos os direitos reservados.</p>
                </div>
                <div class="footer-bottom-right">
                    <a href="#">Guias</a>
                    <a href="#">Termos de Venda</a>
                    <a href="#">Termos de Uso</a>
                    <a href="#">Política de Privacidade</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="header.js"></script>
    <script type="module">
        import { buscarCamisas } from './firebase-hybrid.js';

        function calcPrice(p) {
            const base = parseFloat(p.price) || 0;
            const disc = parseFloat(p.discount) || 0;
            const now = new Date();
            const start = p.promoStart ? new Date(p.promoStart) : null;
            const end = p.promoEnd ? new Date(p.promoEnd) : null;
            const active = disc > 0 && (!start || now >= start) && (!end || now <= end);
            return { price: active ? base * (1 - disc / 100) : base, base, disc: active ? disc : 0 };
        }

        function fmt(val) {
            return 'R$\u00a0' + Number(val).toFixed(2).replace('.', ',');
        }

        function cardHTML(p) {
            const { price, base, disc } = calcPrice(p);
            const hasDisc = disc > 0;
            const img = p.image || 'https://images.unsplash.com/photo-1614624532983-4fe0333299c7?w=400';
            return `<a href="produto.html?id=${p.id}" class="product-card" data-category="${(p.category || '').toLowerCase()}" data-name="${(p.name || '').toLowerCase()}">
                <div class="product-image">
                    <img src="${img}" alt="${p.name}" loading="lazy">
                    <button class="wishlist-btn" onclick="event.preventDefault(); toggleWish(event, ${JSON.stringify(p).replace(/"/g, '&quot;')})">
                        <i class="far fa-heart"></i>
                    </button>
                    ${hasDisc ? `<span style="position:absolute;top:10px;left:10px;background:#dc2626;color:#fff;font-size:11px;font-weight:700;padding:3px 8px;border-radius:20px;">-${Math.round(disc)}%</span>` : ''}
                </div>
                <div class="product-info">
                    <p class="product-category">${p.team || p.category || ''}</p>
                    <h3 class="product-name">${p.name}</h3>
                    <p class="product-price">
                        ${hasDisc ? `<small style="text-decoration:line-through;color:#999;font-weight:400;margin-right:6px;">${fmt(base)}</small>` : ''}
                        <span style="color:${hasDisc ? '#dc2626' : 'inherit'}">${fmt(price)}</span>
                    </p>
                </div>
            </a>`;
        }

        window.toggleWish = function (e, p) {
            e.preventDefault();
            let favs = JSON.parse(localStorage.getItem('favorites') || '[]');
            const i = favs.findIndex(f => f.id === p.id);
            if (i >= 0) favs.splice(i, 1); else favs.push(p);
            localStorage.setItem('favorites', JSON.stringify(favs));
            window.dispatchEvent(new Event('favoritesUpdated'));
            const icon = e.currentTarget.querySelector('i');
            icon.className = i < 0 ? 'fas fa-heart' : 'far fa-heart';
            icon.style.color = i < 0 ? '#dc2626' : '';
        };

        const PAGE_SIZE = 12;
        let allProducts = [];
        let shown = 0;

        function renderProducts(list) {
            const grid = document.getElementById('productsGrid');
            const count = document.getElementById('productsCount');
            const lmContainer = document.getElementById('loadMoreContainer');
            if (!list.length) {
                grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:3rem;color:var(--color-gray-400);">Nenhum produto encontrado.</div>';
                if (count) count.textContent = '0 produtos encontrados';
                if (lmContainer) lmContainer.style.display = 'none';
                return;
            }
            grid.innerHTML = list.slice(0, shown).map(cardHTML).join('');
            if (count) count.textContent = `Mostrando ${Math.min(shown, list.length)} de ${list.length} produtos`;
            if (lmContainer) lmContainer.style.display = shown < list.length ? 'block' : 'none';
        }

        async function init() {
            const params = new URLSearchParams(location.search);
            const catParam = params.get('category') || '';
            const searchParam = params.get('search') || '';
            const discountParam = params.get('discount') === 'true';

            // Activate correct filter button
            document.querySelectorAll('.filter-btn').forEach(b => {
                if (catParam) {
                    b.classList.toggle('active', b.dataset.filter === catParam);
                } else if (discountParam) {
                    b.classList.toggle('active', b.dataset.filter === 'discount');
                } else {
                    b.classList.toggle('active', b.dataset.filter === 'all');
                }
            });

            // Update page title for search
            if (searchParam) {
                const titleEl = document.querySelector('.page-title');
                if (titleEl) titleEl.textContent = `Busca: "${searchParam}"`;
            }

            try {
                const raw = await buscarCamisas();

                // Sort support
                const sortEl = document.getElementById('sortSelect');
                function applySort(arr, sort) {
                    if (sort === 'price-low') return [...arr].sort((a, b) => (parseFloat(a.price) || 0) - (parseFloat(b.price) || 0));
                    if (sort === 'price-high') return [...arr].sort((a, b) => (parseFloat(b.price) || 0) - (parseFloat(a.price) || 0));
                    if (sort === 'newest') return [...arr].sort((a, b) => new Date(b.created_at || 0) - new Date(a.created_at || 0));
                    return arr;
                }

                allProducts = raw.filter(p => {
                    const name = (p.name || '').toLowerCase();
                    const cat = (p.category || '').toLowerCase();
                    const team = (p.team || '').toLowerCase();
                    if (searchParam && !name.includes(searchParam.toLowerCase()) &&
                        !cat.includes(searchParam.toLowerCase()) && !team.includes(searchParam.toLowerCase())) return false;
                    if (catParam && cat !== catParam.toLowerCase()) return false;
                    if (discountParam && !(parseFloat(p.discount) > 0)) return false;
                    return true;
                });

                shown = PAGE_SIZE;
                renderProducts(applySort(allProducts, sortEl?.value));

                sortEl?.addEventListener('change', () => {
                    shown = PAGE_SIZE;
                    renderProducts(applySort(allProducts, sortEl.value));
                });
            } catch (err) {
                document.getElementById('productsGrid').innerHTML =
                    '<div style="grid-column:1/-1;text-align:center;padding:3rem;color:var(--color-gray-400);">Erro ao carregar produtos. Tente novamente.</div>';
                document.getElementById('productsCount').textContent = '';
            }
        }

        document.getElementById('loadMoreBtn')?.addEventListener('click', () => {
            shown += PAGE_SIZE;
            renderProducts(allProducts);
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const f = this.dataset.filter;
                const p = new URLSearchParams(location.search);
                p.delete('category'); p.delete('discount');
                if (f === 'discount') p.set('discount', 'true');
                else if (f !== 'all') p.set('category', f);
                history.replaceState(null, '', '?' + p.toString());
                location.reload();
            });
        });

        init();
    </script>
</body>

</html>