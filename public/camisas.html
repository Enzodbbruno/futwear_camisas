<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FutWear - Todas as Camisas</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad1' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2316a34a;stop-opacity:1' /><stop offset='100%' style='stop-color:%2315803d;stop-opacity:1' /></linearGradient></defs><circle cx='16' cy='16' r='15' fill='url(%23grad1)' stroke='%23fff' stroke-width='2'/><text x='16' y='22' font-family='Arial, sans-serif' font-size='18' font-weight='bold' text-anchor='middle' fill='white'>F</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/premium-header.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Teko:wght@500;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        /* [Existing styles kept, just ensuring font-family availability] */
        /* Enhanced Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ... (rest of styles preserved by not touching them, only replacing from <header> down if needed, but here we are doing a block replace) */
    </style>
</head>

<body class="font-sans bg-gray-50 text-gray-900" style="padding-top: 70px;">
    <!-- Premium Glass Header -->
    <header class="header-glass" id="main-header">
        <div class="header-container">
            <!-- Mobile Toggle -->
            <button class="mobile-toggle">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Logo -->
            <a href="index.html" class="logo-container">
                <span class="logo-text">FUT<span class="logo-accent">WEAR</span></span>
            </a>

            <!-- Desktop Nav -->
            <nav class="nav-menu">
                <a href="index.html" class="nav-link">IN√çCIO</a>
                <a href="camisas.html" class="nav-link">COLE√á√ïES</a>
                <a href="camisas.html?category=clubs" class="nav-link">TIMES</a>
                <a href="camisas.html?category=national" class="nav-link">SELE√á√ïES</a>
                <a href="#" class="nav-link">OFERTAS</a>
            </nav>

            <!-- Actions & Search -->
            <div class="nav-actions">
                <!-- Search Bar (Desktop) -->
                <div class="search-bar-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" placeholder="Buscar camisas..." class="search-input" id="desktopSearchInput">
                </div>

                <!-- Mobile Search Button -->
                <button class="icon-btn mobile-search-btn" onclick="toggleSearch()">
                    <i class="fas fa-search"></i>
                </button>

                <a href="favoritos.html" class="icon-btn relative">
                    <i class="fas fa-heart"></i>
                    <span id="wishlist-count" class="cart-badge hidden">0</span>
                </a>
                <a href="carrinho.html" class="icon-btn relative">
                    <i class="fas fa-shopping-bag"></i>
                    <span id="cart-count" class="cart-badge">0</span>
                </a>
                <a href="perfil.html" class="icon-btn" id="profile-btn">
                    <i class="fas fa-user"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-20">
        <!-- Page Header -->
        <div class="bg-gradient-to-r from-green-600 to-blue-600 text-white py-16">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-5xl font-bold mb-4 animate-slide-up">Todas as Camisas</h1>
                <p class="text-xl text-green-100 animate-fade-in" style="animation-delay: 0.3s;">Encontre a camisa
                    perfeita do seu time favorito</p>
            </div>
        </div>

        <!-- Shipping Policy -->
        <div class="py-12 bg-white">
            <div class="container mx-auto px-6">
                <div class="glass-card-strong rounded-2xl shadow-enhanced-lg p-8 animate-scale-in">
                    <h2 class="text-3xl font-bold text-center mb-8 text-gradient">üöö Pol√≠tica de Frete</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div
                            class="glass-card rounded-xl p-6 text-center hover:scale-105 transition-all duration-300 animate-slide-left">
                            <div class="text-5xl mb-4 animate-bounce">üì¶</div>
                            <h3 class="font-bold text-orange-600 text-xl mb-2">1 Camisa</h3>
                            <p class="text-orange-500 font-bold text-2xl">R$ 30,00</p>
                        </div>
                        <div
                            class="glass-card rounded-xl p-6 text-center hover:scale-105 transition-all duration-300 animate-slide-up">
                            <div class="text-5xl mb-4 animate-bounce" style="animation-delay: 0.2s;">üì¶üì¶</div>
                            <h3 class="font-bold text-blue-600 text-xl mb-2">2 Camisas</h3>
                            <p class="text-blue-500 font-bold text-2xl">R$ 20,00</p>
                        </div>
                        <div
                            class="glass-card rounded-xl p-6 text-center hover:scale-105 transition-all duration-300 animate-slide-right">
                            <div class="text-5xl mb-4 animate-bounce" style="animation-delay: 0.4s;">üéÅ</div>
                            <h3 class="font-bold text-green-600 text-xl mb-2">3+ Camisas</h3>
                            <p class="text-green-500 font-bold text-2xl">FRETE GR√ÅTIS</p>
                        </div>
                    </div>
                    <p class="text-center mt-6 text-gray-600 text-lg animate-fade-in">
                        üí° <strong>Dica:</strong> Compre 3 camisas e economize no frete!
                    </p>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="py-8 bg-white">
            <div class="container mx-auto px-6">
                <div class="glass-card-strong rounded-2xl shadow-enhanced-lg p-6 animate-scale-in">
                    <div class="flex flex-col lg:flex-row gap-6">
                        <!-- Search Bar -->
                        <div class="flex-1">
                            <div class="relative">
                                <input type="text" id="searchInput" placeholder="Buscar camisas..."
                                    class="filter-input w-full px-4 py-3 pl-12 pr-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                                <i
                                    class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>

                        <!-- Category Filter -->
                        <div class="lg:w-48">
                            <select id="categoryFilter"
                                class="filter-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                                <option value="">Todas as Categorias</option>
                                <option value="times-brasileiros">Times Brasileiros</option>
                                <option value="times-europeus">Times Europeus</option>
                                <option value="selecoes">Sele√ß√µes</option>
                            </select>
                        </div>

                        <!-- Price Filter -->
                        <div class="lg:w-48">
                            <select id="priceFilter"
                                class="filter-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                                <option value="">Todos os Pre√ßos</option>
                                <option value="0-120">At√© R$ 120</option>
                                <option value="120-140">R$ 120 - R$ 140</option>
                                <option value="140-150">R$ 140 - R$ 150</option>
                                <option value="150+">Acima de R$ 150</option>
                            </select>
                        </div>

                        <!-- Sort Filter -->
                        <div class="lg:w-48">
                            <select id="sortFilter"
                                class="filter-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300">
                                <option value="relevance">Relev√¢ncia</option>
                                <option value="price-low">Menor Pre√ßo</option>
                                <option value="price-high">Maior Pre√ßo</option>
                                <option value="name">Nome A-Z</option>
                            </select>
                        </div>

                        <!-- Clear Filters -->
                        <button id="clearFilters"
                            class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-all duration-300 hover:scale-105 flex items-center justify-center shadow-sm">
                            <i class="fas fa-times mr-2"></i>Limpar
                        </button>
                    </div>

                    <!-- Active Filters -->
                    <div id="activeFilters" class="mt-4 flex flex-wrap gap-2 hidden">
                        <!-- Active filter chips will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div class="py-12 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="glass-card-strong rounded-2xl shadow-enhanced-lg p-8 animate-scale-in">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold text-gradient">Produtos</h2>
                        <div id="productCount" class="text-gray-600 text-lg font-semibold animate-fade-in">Carregando...
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingState" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
                        <div class="glass-card rounded-xl p-6 animate-pulse">
                            <div class="loading-shimmer h-56 rounded-lg mb-4"></div>
                            <div class="loading-shimmer h-4 rounded w-3/4 mb-3"></div>
                            <div class="loading-shimmer h-3 rounded w-1/2 mb-4"></div>
                            <div class="loading-shimmer h-12 rounded-lg"></div>
                        </div>
                        <div class="glass-card rounded-xl p-6 animate-pulse" style="animation-delay: 0.2s;">
                            <div class="loading-shimmer h-56 rounded-lg mb-4"></div>
                            <div class="loading-shimmer h-4 rounded w-3/4 mb-3"></div>
                            <div class="loading-shimmer h-3 rounded w-1/2 mb-4"></div>
                            <div class="loading-shimmer h-12 rounded-lg"></div>
                        </div>
                        <div class="glass-card rounded-xl p-6 animate-pulse" style="animation-delay: 0.4s;">
                            <div class="loading-shimmer h-56 rounded-lg mb-4"></div>
                            <div class="loading-shimmer h-4 rounded w-3/4 mb-3"></div>
                            <div class="loading-shimmer h-3 rounded w-1/2 mb-4"></div>
                            <div class="loading-shimmer h-12 rounded-lg"></div>
                        </div>
                    </div>

                    <!-- Products Grid -->
                    <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 hidden">
                        <!-- Products will be inserted here -->
                    </div>

                    <!-- Pagination -->
                    <div id="pagination" class="flex items-center justify-center gap-2 mt-8 hidden"></div>

                    <!-- Empty State -->
                    <div id="emptyState" class="text-center py-16 hidden">
                        <i class="fas fa-shirt text-8xl text-gray-300 mb-6 animate-bounce"></i>
                        <h3 class="text-2xl font-bold text-gray-600 mb-4">Nenhum produto encontrado</h3>
                        <p class="text-gray-500 text-lg">Tente ajustar os filtros ou buscar por outros termos.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { buscarCamisas, addToCart } from './firebase-hybrid.js';
        import './favorites-system.js';

        // Make addToCart globally available
        window.addToCart = addToCart;

        // Fun√ß√£o auxiliar para adicionar ao carrinho
        window.addProductToCart = function (product) {
            console.log('üõí Adicionando produto ao carrinho:', product);
            addToCart(product);
        };

        // Helpers de feedback do bot√£o "Adicionar ao Carrinho"
        function setButtonLoading(button, isLoading) {
            if (!button) return;
            if (isLoading) {
                button.dataset.busy = '1';
                button.disabled = true;
                button.classList.add('opacity-80');
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adicionando...';
            } else {
                button.disabled = false;
                button.classList.remove('opacity-80');
            }
        }

        function flashButtonSuccess(button) {
            if (!button) return;
            button.innerHTML = '<i class="fas fa-check mr-2"></i>Adicionado!';
            button.classList.add('bg-green-700');
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-shopping-cart mr-2"></i>Adicionar ao Carrinho';
                button.classList.remove('bg-green-700');
                button.dataset.busy = '0';
            }, 900);
        }

        // Fun√ß√£o para adicionar produto por √≠ndice (agora redireciona para a p√°gina do produto para escolher tamanho)
        window.addProductByIndex = function (index) {
            console.log('üõí Adicionando produto por √≠ndice:', index);
            console.log('üì¶ filteredProducts dispon√≠vel:', filteredProducts);
            const product = filteredProducts[index];
            if (product) {
                console.log('‚úÖ Produto encontrado:', product);
                try {
                    const button = document.querySelector(`[data-add-btn="${product.id}"]`);
                    // Feedback curto antes do redirect
                    if (button) {
                        button.classList.add('scale-105');
                        setTimeout(() => button.classList.remove('scale-105'), 120);
                    }
                } catch { }
                // Redireciona para a p√°gina do produto para sele√ß√£o de tamanho/op√ß√µes
                window.location.href = `produto.html?id=${product.id}`;
            } else {
                console.error('‚ùå Produto n√£o encontrado no √≠ndice:', index);
                console.log('üì¶ filteredProducts length:', filteredProducts.length);
            }
        };

        // Fun√ß√£o para toggle de favoritos por √≠ndice
        window.toggleFavoriteByIndex = function (index) {
            console.log('‚ù§Ô∏è Toggle favorito por √≠ndice:', index);
            console.log('üì¶ filteredProducts dispon√≠vel:', filteredProducts);
            console.log('üîß toggleFavorite dispon√≠vel:', typeof window.toggleFavorite);

            const product = filteredProducts[index];
            if (product) {
                console.log('‚úÖ Produto encontrado para favorito:', product);

                if (typeof window.toggleFavorite === 'function') {
                    const result = window.toggleFavorite(product);
                    console.log('üéØ Resultado do toggle:', result);

                    // Atualiza imediatamente o √≠cone do bot√£o e o contador no header
                    const button = document.querySelector(`[data-product-id="${product.id}"]`);
                    if (button) {
                        const heartIcon = button.querySelector('i');
                        if (window.isFavorite && window.isFavorite(product.id)) {
                            heartIcon.classList.remove('far');
                            heartIcon.classList.add('fas');
                            button.classList.add('text-red-500');
                            button.classList.remove('text-gray-600');
                            console.log('‚ù§Ô∏è √çcone atualizado para favorito');
                        } else {
                            heartIcon.classList.remove('fas');
                            heartIcon.classList.add('far');
                            button.classList.remove('text-red-500');
                            button.classList.add('text-gray-600');
                            console.log('ü§ç √çcone atualizado para n√£o favorito');
                        }
                        // pequena anima√ß√£o de feedback
                        button.classList.add('scale-110');
                        setTimeout(() => button.classList.remove('scale-110'), 150);
                    } else {
                        console.error('‚ùå Bot√£o n√£o encontrado para produto:', product.id);
                    }
                    // Atualiza todos os √≠cones e o contador
                    updateFavoriteIcons();
                    updateFavoritesCount();
                } else {
                    console.error('‚ùå Fun√ß√£o toggleFavorite n√£o est√° dispon√≠vel');
                }
            } else {
                console.error('‚ùå Produto n√£o encontrado no √≠ndice para favorito:', index);
            }
        };

        // State
        let products = [];
        let filteredProducts = [];
        const pageSize = 10;
        let currentPage = 1;
        let currentFilters = {
            search: '',
            category: '',
            price: '',
            sort: 'relevance'
        };

        // Avalia√ß√µes: helpers para m√©dia e estrelas (replicando l√≥gica de produto.html)
        function getAverageRating(productId) {
            try {
                const saved = localStorage.getItem(`reviews_${productId}`);
                const reviews = saved ? JSON.parse(saved) : [];
                const count = Array.isArray(reviews) ? reviews.length : 0;
                const avg = count > 0 ? (reviews.reduce((s, r) => s + (r.rating || 0), 0) / count) : 0;
                return { avg, count };
            } catch {
                return { avg: 0, count: 0 };
            }
        }

        function renderStarsHTML(rating) {
            let html = '';
            for (let i = 1; i <= 5; i++) {
                // Mesmo crit√©rio de produto.html: estrela cheia at√© floor(rating) e tamb√©m a pr√≥xima se houver fra√ß√£o
                let cls = 'fas fa-star ';
                if (i <= Math.floor(rating)) {
                    cls += 'text-yellow-400';
                } else if (i === Math.ceil(rating) && rating % 1 !== 0) {
                    cls += 'text-yellow-400';
                } else {
                    cls += 'text-gray-300';
                }
                html += `<i class="${cls} text-xs"></i>`;
            }
            return html;
        }

        // DOM Elements
        const loadingState = document.getElementById('loadingState');
        const productsGrid = document.getElementById('productsGrid');
        const emptyState = document.getElementById('emptyState');
        const productCount = document.getElementById('productCount');
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const priceFilter = document.getElementById('priceFilter');
        const sortFilter = document.getElementById('sortFilter');
        const clearFilters = document.getElementById('clearFilters');
        const activeFilters = document.getElementById('activeFilters');

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('üöÄ Iniciando carregamento da p√°gina...');
            // Read page from query string (?p=2)
            try {
                const url = new URL(window.location.href);
                const p = parseInt(url.searchParams.get('p') || '1', 10);
                if (!isNaN(p) && p > 0) currentPage = p;
            } catch { }
            await loadProducts();
            initializeFilters();
        });

        // Initialize filters
        function initializeFilters() {
            // Search input with debounce
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    currentFilters.search = e.target.value.toLowerCase();
                    currentPage = 1;
                    applyFilters();
                }, 300);
            });

            // Category filter
            categoryFilter.addEventListener('change', (e) => {
                currentFilters.category = e.target.value;
                currentPage = 1;
                applyFilters();
            });

            // Price filter
            priceFilter.addEventListener('change', (e) => {
                currentFilters.price = e.target.value;
                currentPage = 1;
                applyFilters();
            });

            // Sort filter
            sortFilter.addEventListener('change', (e) => {
                currentFilters.sort = e.target.value;
                currentPage = 1;
                applyFilters();
            });

            // Clear filters
            clearFilters.addEventListener('click', () => {
                clearAllFilters();
            });
        }

        // Apply filters
        function applyFilters() {
            console.log('üîç Aplicando filtros:', currentFilters);

            filteredProducts = products.filter(product => {
                // Search filter
                if (currentFilters.search && !product.name.toLowerCase().includes(currentFilters.search) &&
                    !product.team?.toLowerCase().includes(currentFilters.search) &&
                    !product.league?.toLowerCase().includes(currentFilters.search)) {
                    return false;
                }

                // Category filter
                if (currentFilters.category && product.category !== currentFilters.category) {
                    return false;
                }

                // Price filter
                if (currentFilters.price) {
                    const [min, max] = currentFilters.price.split('-').map(Number);
                    if (max && (product.price < min || product.price > max)) {
                        return false;
                    }
                    if (currentFilters.price === '150+' && product.price <= 150) {
                        return false;
                    }
                }

                return true;
            });

            // Sort products
            sortProducts();

            // Update active filters display
            updateActiveFilters();

            // Render filtered products
            renderProducts();
        }

        // Sort products
        function sortProducts() {
            switch (currentFilters.sort) {
                case 'price-low':
                    filteredProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'name':
                    filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                default:
                    // Keep original order for relevance
                    break;
            }
        }

        // Update active filters display
        function updateActiveFilters() {
            const activeFiltersArray = [];

            if (currentFilters.search) {
                activeFiltersArray.push({
                    type: 'search',
                    label: `Busca: "${currentFilters.search}"`,
                    value: currentFilters.search
                });
            }

            if (currentFilters.category) {
                const categoryLabel = categoryFilter.options[categoryFilter.selectedIndex].text;
                activeFiltersArray.push({
                    type: 'category',
                    label: categoryLabel,
                    value: currentFilters.category
                });
            }

            if (currentFilters.price) {
                const priceLabel = priceFilter.options[priceFilter.selectedIndex].text;
                activeFiltersArray.push({
                    type: 'price',
                    label: priceLabel,
                    value: currentFilters.price
                });
            }

            if (activeFiltersArray.length > 0) {
                activeFilters.innerHTML = activeFiltersArray.map(filter => `
                    <span class="inline-flex items-center gap-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                        ${filter.label}
                        <button onclick="removeFilter('${filter.type}')" class="hover:bg-green-200 rounded-full p-1 transition-colors">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    </span>
                `).join('');
                activeFilters.classList.remove('hidden');
            } else {
                activeFilters.classList.add('hidden');
            }
        }

        // Remove specific filter
        window.removeFilter = function (filterType) {
            switch (filterType) {
                case 'search':
                    currentFilters.search = '';
                    searchInput.value = '';
                    break;
                case 'category':
                    currentFilters.category = '';
                    categoryFilter.value = '';
                    break;
                case 'price':
                    currentFilters.price = '';
                    priceFilter.value = '';
                    break;
            }
            applyFilters();
        };

        // Clear all filters
        function clearAllFilters() {
            currentFilters = {
                search: '',
                category: '',
                price: '',
                sort: 'relevance'
            };

            searchInput.value = '';
            categoryFilter.value = '';
            priceFilter.value = '';
            sortFilter.value = 'relevance';

            applyFilters();
        }

        async function loadProducts() {
            try {
                console.log('üì¶ Carregando produtos...');
                productCount.textContent = 'Carregando produtos...';

                // Show loading state
                loadingState.classList.remove('hidden');
                productsGrid.classList.add('hidden');
                emptyState.classList.add('hidden');

                // Load products
                const produtos = await buscarCamisas();
                console.log('‚úÖ Produtos carregados:', produtos);
                console.log('üìä Total de produtos no array:', produtos ? produtos.length : 0);
                console.log('üîç Primeiro produto:', produtos && produtos.length > 0 ? produtos[0] : 'Nenhum produto');

                if (!produtos || produtos.length === 0) {
                    console.log('‚ùå Nenhum produto encontrado');
                    showEmptyState();
                    return;
                }

                products = produtos;
                filteredProducts = produtos;
                console.log('üìä Total de produtos:', products.length);

                // Hide loading and show products
                loadingState.classList.add('hidden');
                productsGrid.classList.remove('hidden');

                renderProducts();

            } catch (error) {
                console.error('üí• Erro ao carregar produtos:', error);
                showErrorState();
            }
        }

        function isPromoActive(prod) {
            try {
                if (!(prod.discount && prod.discount > 0)) return false;
                const now = new Date();
                const start = prod.promoStart ? new Date(prod.promoStart) : null;
                const end = prod.promoEnd ? new Date(prod.promoEnd) : null;
                if (start && end) return now >= start && now <= end;
                if (start && !end) return now >= start;
                if (!start && end) return now <= end;
                return true;
            } catch { return !!prod.discount; }
        }

        function renderProducts() {
            console.log('üé® Renderizando produtos...');

            const productsToRender = filteredProducts.length > 0 ? filteredProducts : products;

            if (productsToRender.length === 0) {
                showEmptyState();
                return;
            }

            // Pagination math
            const total = productsToRender.length;
            const start = Math.min((currentPage - 1) * pageSize, Math.max(total - 1, 0));
            const end = Math.min(start + pageSize, total);
            const pageItems = productsToRender.slice(start, end);

            // Update header count
            productCount.textContent = `${total} produtos ‚Ä¢ mostrando ${start + 1}-${end}`;

            productsGrid.innerHTML = pageItems.map((product, index) => {
                const promoActive = isPromoActive(product);
                const discounted = promoActive ? (product.price * (1 - product.discount / 100)) : product.price;
                return `
                <div class="product-card rounded-2xl overflow-hidden animate-fade-in group cursor-pointer" style="animation-delay: ${index * 0.1}s;" onclick="goToProduct('${product.id}')">
                    <div class="relative overflow-hidden">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-56 object-cover transition-all duration-500 group-hover:scale-110">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <button onclick="event.stopPropagation(); toggleFavoriteByIndex(${start + index})" class="absolute top-4 right-4 w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center text-gray-600 hover:bg-red-500 hover:text-white transition-all duration-300 hover:scale-110 shadow-lg" data-product-id="${product.id}">
                            <i class="far fa-heart"></i>
                        </button>
                        ${promoActive ? `<span class='absolute top-4 left-4 bg-red-500 text-white text-xs px-3 py-1 rounded-full font-bold'>-${product.discount}%</span>` : `<span class="absolute top-4 left-4 text-xs bg-green-100 text-green-600 px-3 py-1 rounded-full font-semibold shadow-sm">Em estoque</span>`}
                        <div class="absolute bottom-4 left-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <div class="bg-white/90 backdrop-blur-sm rounded-lg p-2">
                                <p class="text-xs text-gray-600 text-center">Clique para ver detalhes</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-gradient-to-b from-white to-gray-50">
                        <div class="mb-4">
                            <h3 class="font-bold text-gray-800 text-lg mb-2 line-clamp-2">${product.name}</h3>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full font-medium">${product.type}</span>
                                <span class="text-xs bg-purple-100 text-purple-600 px-2 py-1 rounded-full font-medium">${product.league || 'N/A'}</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fas fa-users mr-1"></i>
                                <span class="font-semibold text-gray-800">${product.team || 'N/A'}</span>
                            </p>
                        </div>
                        
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex flex-col">
                                <span class="text-2xl font-bold text-gray-900">R$ ${discounted.toFixed(2).replace('.', ',')}</span>
                                ${promoActive ? `<span class='text-sm text-gray-500 line-through'>R$ ${product.price.toFixed(2).replace('.', ',')}</span>` : ''}
                                <span class="text-xs text-gray-500">ou 3x de R$ ${(discounted / 3).toFixed(2).replace('.', ',')}</span>
                            </div>
                            <div class="text-right">
                                ${(() => {
                        const { avg } = getAverageRating(product.id);
                        const stars = renderStarsHTML(avg);
                        const avgText = (avg || 0).toFixed(1);
                        return `<div class=\"flex items-center\">` +
                            `<div class=\"flex mr-2\">${stars}</div>` +
                            `<span class=\"text-sm text-gray-600\">(${avgText})</span>` +
                            `</div>`;
                    })()}
                            </div>
                        </div>
                        
                        <button data-add-btn="${product.id}" onclick="event.stopPropagation(); addProductByIndex(${start + index})" class="w-full btn-primary text-white py-3 px-6 rounded-xl font-semibold transition-all duration-300 hover:scale-105 flex items-center justify-center shadow-lg">
                            <i class="fas fa-shopping-cart mr-2"></i>Adicionar ao Carrinho
                        </button>
                    </div>
                </div>
            `}).join('');

            console.log('‚úÖ Produtos renderizados com sucesso!');

            // Atualiza √≠cones de favoritos ap√≥s renderiza√ß√£o
            updateFavoriteIcons();

            // Render pagination
            renderPagination(total);
        }

        function renderPagination(total) {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(total / pageSize) || 1;
            if (totalPages <= 1) {
                pagination.classList.add('hidden');
                pagination.innerHTML = '';
                return;
            }
            pagination.classList.remove('hidden');

            const makeBtn = (label, page, disabled = false, active = false) => `
                <button 
                    ${disabled ? 'disabled' : ''}
                    class="px-3 py-2 rounded-lg border ${active ? 'bg-green-600 text-white border-green-600' : 'bg-white text-gray-700 border-gray-200 hover:bg-gray-50'} disabled:opacity-50 disabled:cursor-not-allowed"
                    onclick="${disabled ? '' : `goToPage(${page})`}"
                >${label}</button>
            `;

            // Simple window around current page
            const windowSize = 3;
            const startPage = Math.max(1, currentPage - windowSize);
            const endPage = Math.min(totalPages, currentPage + windowSize);

            let html = '';
            html += makeBtn('¬´', Math.max(1, currentPage - 1), currentPage === 1);
            if (startPage > 1) html += makeBtn('1', 1, false, currentPage === 1);
            if (startPage > 2) html += `<span class="px-2 text-gray-400">‚Ä¶</span>`;
            for (let p = startPage; p <= endPage; p++) {
                html += makeBtn(String(p), p, false, p === currentPage);
            }
            if (endPage < totalPages - 1) html += `<span class="px-2 text-gray-400">‚Ä¶</span>`;
            if (endPage < totalPages) html += makeBtn(String(totalPages), totalPages, false, currentPage === totalPages);
            html += makeBtn('¬ª', Math.min(totalPages, currentPage + 1), currentPage === totalPages);

            pagination.innerHTML = html;
        }

        // Expose page navigation
        window.goToPage = function (page) {
            const productsToRender = filteredProducts.length > 0 ? filteredProducts : products;
            const totalPages = Math.ceil(productsToRender.length / pageSize) || 1;
            currentPage = Math.min(Math.max(1, page), totalPages);
            // Update URL without reload
            try {
                const url = new URL(window.location.href);
                url.searchParams.set('p', String(currentPage));
                window.history.replaceState({}, '', url.toString());
            } catch { }
            renderProducts();
        };

        function showEmptyState() {
            console.log('üì≠ Mostrando estado vazio');
            loadingState.classList.add('hidden');
            productsGrid.classList.add('hidden');
            emptyState.classList.remove('hidden');
            productCount.textContent = 'Nenhum produto encontrado';
        }

        function showErrorState() {
            console.log('üí• Mostrando estado de erro');
            loadingState.classList.add('hidden');
            productsGrid.classList.add('hidden');
            emptyState.classList.remove('hidden');
            emptyState.innerHTML = `
                <i class="fas fa-exclamation-triangle text-8xl text-red-400 mb-6 animate-bounce"></i>
                <h3 class="text-2xl font-bold text-red-600 mb-4">Erro ao carregar produtos</h3>
                <p class="text-gray-600 text-lg mb-6">Ocorreu um erro ao carregar os produtos. Tente recarregar a p√°gina.</p>
                <button onclick="location.reload()" class="btn-primary text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 hover:scale-105 flex items-center justify-center mx-auto">
                    <i class="fas fa-refresh mr-2"></i>Recarregar P√°gina
                </button>
            `;
            productCount.textContent = 'Erro ao carregar';
        }

        // Fun√ß√£o para atualizar √≠cones de favoritos ap√≥s renderiza√ß√£o
        function updateFavoriteIcons() {
            setTimeout(() => {
                console.log('üîÑ Atualizando √≠cones de favoritos...');
                document.querySelectorAll('[data-product-id]').forEach(button => {
                    const productId = button.getAttribute('data-product-id');
                    const heartIcon = button.querySelector('i');

                    console.log(`üîç Verificando produto ${productId}:`, window.isFavorite ? window.isFavorite(productId) : 'fun√ß√£o n√£o dispon√≠vel');

                    if (window.isFavorite && window.isFavorite(productId)) {
                        heartIcon.classList.remove('far');
                        heartIcon.classList.add('fas');
                        button.classList.add('text-red-500');
                        button.classList.remove('text-gray-600');
                        console.log(`‚úÖ Produto ${productId} marcado como favorito`);
                    } else {
                        heartIcon.classList.remove('fas');
                        heartIcon.classList.add('far');
                        button.classList.remove('text-red-500');
                        button.classList.add('text-gray-600');
                        console.log(`‚ùå Produto ${productId} n√£o √© favorito`);
                    }
                });
            }, 100);
        }

        // Search function
        window.toggleSearch = function () {
            console.log('üîç Toggle search');
            alert('Funcionalidade de busca ser√° implementada!');
        };

        // Go to product page
        window.goToProduct = function (productId) {
            console.log('üîó Redirecionando para produto:', productId);
            window.location.href = `produto.html?id=${productId}`;
        };

        // Update cart icon
        function updateCartIcon() {
            try {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
                const cartCount = document.getElementById('cartCount');
                if (cartCount) {
                    cartCount.textContent = totalItems;
                    cartCount.classList.toggle('hidden', totalItems === 0);
                }
            } catch (error) {
                console.warn('Erro ao atualizar √≠cone do carrinho:', error);
            }
        }

        // Update wishlist icon (delegates to favorites system)
        function updateWishlistIcon() {
            try {
                const count = typeof window.getFavoritesCount === 'function' ? window.getFavoritesCount() : (Array.isArray(window.getFavorites?.()) ? window.getFavorites().length : 0);
                const wishlistCount = document.getElementById('wishlistCount');
                if (wishlistCount) {
                    wishlistCount.textContent = count;
                    wishlistCount.classList.remove('hidden');
                    wishlistCount.setAttribute('aria-label', `Favoritos: ${count}`);
                    wishlistCount.setAttribute('title', `Favoritos: ${count}`);
                }
            } catch (error) {
                console.warn('Erro ao atualizar √≠cone de favoritos:', error);
            }
        }

        // Fun√ß√£o para atualizar contador de favoritos
        function updateFavoritesCount() {
            try {
                if (typeof window.getFavorites === 'function') {
                    const favorites = window.getFavorites();
                    const count = favorites.length;
                    const wishlistCount = document.getElementById('wishlistCount');
                    if (wishlistCount) {
                        wishlistCount.textContent = count;
                        wishlistCount.classList.toggle('hidden', count === 0);
                        console.log('üìä Contador de favoritos atualizado:', count);
                    }
                } else {
                    console.warn('‚ö†Ô∏è Fun√ß√£o getFavorites n√£o est√° dispon√≠vel');
                }
            } catch (error) {
                console.warn('Erro ao atualizar contador de favoritos:', error);
            }
        }

        // Initialize icons
        updateCartIcon();
        updateWishlistIcon();
        updateFavoritesCount();

        // Escuta mudan√ßas nos favoritos
        window.addEventListener('favoritesUpdated', () => {
            console.log('üîÑ Favoritos atualizados, atualizando contador...');
            updateFavoritesCount();
            updateFavoriteIcons();
        });
    </script>

    <!-- Footer Pro 2026 -->
    <footer class="bg-[#0f1012] text-gray-400 border-t border-gray-800">
        <div class="container mx-auto px-6 py-16">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-12 mb-16">
                <!-- Brand Section (4 cols) -->
                <div class="lg:col-span-4 space-y-6">
                    <a href="index.html" class="inline-block text-2xl font-bold text-white tracking-tight">
                        FUT<span class="text-green-500">WEAR</span>
                    </a>
                    <p class="text-base leading-relaxed text-gray-500">
                        A plataforma definitiva para apaixonados por futebol.
                        Qualidade premium, autenticidade garantida e a melhor experi√™ncia de compra do mercado.
                    </p>
                    <div class="flex items-center gap-4 pt-2">
                        <a href="#"
                            class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-white hover:bg-green-600 transition-all duration-300">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#"
                            class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-white hover:bg-green-600 transition-all duration-300">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#"
                            class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-white hover:bg-green-600 transition-all duration-300">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
                <!-- Navigation (2 cols) -->
                <div class="lg:col-span-2 space-y-6">
                    <h4 class="text-white font-semibold tracking-wide uppercase text-sm">Navega√ß√£o</h4>
                    <ul class="space-y-4">
                        <li><a href="index.html" class="hover:text-green-500 transition-colors">In√≠cio</a></li>
                        <li><a href="camisas.html" class="hover:text-green-500 transition-colors">Cole√ß√µes</a></li>
                        <li><a href="camisas.html?category=clubs"
                                class="hover:text-green-500 transition-colors">Times</a></li>
                        <li><a href="camisas.html?category=national"
                                class="hover:text-green-500 transition-colors">Sele√ß√µes</a></li>
                        <li><a href="#promocoes" class="hover:text-green-500 transition-colors">OFERTAS</a></li>
                    </ul>
                </div>
                <!-- Support (3 cols) -->
                <div class="lg:col-span-3 space-y-6">
                    <h4 class="text-white font-semibold tracking-wide uppercase text-sm">Suporte</h4>
                    <ul class="space-y-4">
                        <li><a href="#" class="hover:text-green-500 transition-colors">Central de Ajuda</a></li>
                        <li><a href="#" class="hover:text-green-500 transition-colors">Trocas e Devolu√ß√µes</a></li>
                        <li><a href="#" class="hover:text-green-500 transition-colors">Pol√≠tica de Privacidade</a></li>
                        <li><a href="#" class="hover:text-green-500 transition-colors">Termos de Uso</a></li>
                        <li><a href="#" class="hover:text-green-500 transition-colors">Rastrear Pedido</a></li>
                    </ul>
                </div>
                <!-- Newsletter (3 cols) -->
                <div class="lg:col-span-3 space-y-6">
                    <h4 class="text-white font-semibold tracking-wide uppercase text-sm">Fique por dentro</h4>
                    <p class="text-sm text-gray-500">Receba ofertas exclusivas e novidades.</p>
                    <form class="space-y-3">
                        <div class="relative">
                            <input type="email" placeholder="Seu melhor e-mail"
                                class="w-full bg-gray-900 border border-gray-800 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-green-500 transition-colors">
                        </div>
                        <button type="button"
                            class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition-colors">
                            Inscrever-se
                        </button>
                    </form>
                </div>
            </div>
            <!-- Bottom Bar -->
            <div class="pt-8 border-t border-gray-800 flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="text-sm text-gray-600">
                    &copy; 2026 FutWear Sports. Todos os direitos reservados.
                </div>
                <div class="flex items-center gap-4 text-gray-500">
                    <i class="fab fa-cc-visa text-2xl hover:text-white transition-colors"></i>
                    <i class="fab fa-cc-mastercard text-2xl hover:text-white transition-colors"></i>
                    <i class="fab fa-cc-amex text-2xl hover:text-white transition-colors"></i>
                    <i class="fab fa-pix text-2xl hover:text-white transition-colors"></i>
                </div>
                <div class="flex items-center gap-2 text-sm text-gray-500">
                    <i class="fas fa-lock text-green-500"></i>
                    Compra 100% Segura
                </div>
            </div>
        </div>
    </footer>

    <!-- Adidas Style Header Script -->

</body>

<script src="js/header.js"></script>

</html>