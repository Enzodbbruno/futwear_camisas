<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - FutWear</title>
    <meta name="description" content="Gerencie seu perfil, endereços e pedidos na FutWear.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad1' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2316a34a;stop-opacity:1' /><stop offset='100%' style='stop-color:%2315803d;stop-opacity:1' /></linearGradient></defs><circle cx='16' cy='16' r='15' fill='url(%23grad1)' stroke='%23fff' stroke-width='2'/><text x='16' y='22' font-family='Arial, sans-serif' font-size='18' font-weight='bold' text-anchor='middle' fill='white'>F</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <style>
        .profile-page {
            padding: var(--spacing-3xl) 0;
        }

        .profile-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: var(--spacing-3xl);
        }

        .profile-sidebar {
            position: sticky;
            top: calc(var(--header-height) + var(--spacing-xl));
            height: fit-content;
        }

        .profile-nav {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .profile-nav-link {
            padding: var(--spacing-md);
            font-size: var(--font-size-base);
            font-weight: 500;
            color: var(--color-gray-400);
            border-left: 3px solid transparent;
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .profile-nav-link:hover,
        .profile-nav-link.active {
            color: var(--color-black);
            border-left-color: var(--color-black);
        }

        .profile-nav-link.logout {
            color: var(--color-accent);
        }

        .profile-content {
            display: block;
        }

        .profile-header {
            margin-bottom: var(--spacing-2xl);
        }

        .profile-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .profile-subtitle {
            color: var(--color-gray-400);
        }

        .profile-card {
            background: var(--color-white);
            border: 1px solid var(--color-gray-100);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-edit {
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            font-family: var(--font-primary);
        }

        .btn-edit:hover {
            color: var(--color-black);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg);
        }

        .info-item label {
            display: block;
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
            margin-bottom: var(--spacing-xs);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-item p {
            font-size: var(--font-size-base);
            font-weight: 500;
        }

        .address-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .address-item {
            padding: var(--spacing-md);
            border: 1px solid var(--color-gray-100);
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .address-badge {
            background: var(--color-primary);
            color: var(--color-white);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: var(--spacing-xs);
            display: inline-block;
        }

        .order-table {
            width: 100%;
            border-collapse: collapse;
        }

        .order-table th {
            text-align: left;
            padding: var(--spacing-md);
            border-bottom: 2px solid var(--color-gray-100);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--color-gray-400);
        }

        .order-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--color-gray-100);
            font-size: var(--font-size-sm);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: var(--font-size-xs);
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-entregue {
            background: #d1fae5;
            color: #065f46;
        }

        .status-enviado {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-pendente {
            background: #fef3c7;
            color: #92400e;
        }

        .not-logged {
            text-align: center;
            padding: 80px var(--spacing-xl);
        }

        .not-logged i {
            font-size: 4rem;
            color: var(--color-gray-200);
            display: block;
            margin-bottom: var(--spacing-xl);
        }

        .not-logged h2 {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }

        .not-logged p {
            color: var(--color-gray-400);
            margin-bottom: var(--spacing-2xl);
        }

        @media (max-width: 960px) {
            .profile-layout {
                grid-template-columns: 1fr;
            }

            .profile-sidebar {
                position: static;
            }

            .profile-nav {
                flex-direction: row;
                overflow-x: auto;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 640px) {
            .order-table {
                font-size: 12px;
            }

            .order-table th,
            .order-table td {
                padding: var(--spacing-sm);
            }
        }
    </style>
</head>

<body>
    <!-- Announcement Bar -->
    <div class="announcement-bar">
        <span><span class="ann-dot"></span> Frete Grátis em compras acima de 3 camisas! <span
                class="ann-dot"></span></span>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-top-content">
                    <div class="header-logo">
                        <a href="index.html"><span class="logo-text">FUT<span class="logo-accent">WEAR</span></span></a>
                    </div>
                    <nav class="header-nav">
                        <a href="camisas.html" class="nav-link">Novidades</a>
                        <a href="camisas.html?category=clubs" class="nav-link">Times</a>
                        <a href="camisas.html?category=national" class="nav-link">Seleções</a>
                        <a href="camisas.html?category=retro" class="nav-link">Retrô</a>
                        <a href="camisas.html?discount=true" class="nav-link">Ofertas</a>
                    </nav>
                    <div class="header-actions">
                        <div class="search-container">
                            <button class="search-btn" id="searchToggle" aria-label="Buscar"><i
                                    class="fas fa-search"></i></button>
                        </div>
                        <a href="favoritos.html" class="icon-btn" aria-label="Favoritos">
                            <i class="far fa-heart"></i>
                            <span class="badge" id="wishlistBadge">0</span>
                        </a>
                        <a href="carrinho.html" class="icon-btn" aria-label="Carrinho">
                            <i class="fas fa-shopping-bag"></i>
                            <span class="badge" id="cartBadge">0</span>
                        </a>
                        <a href="perfil.html" class="icon-btn auth-avatar" id="profileLink" aria-label="Perfil">
                            <span id="authAvatar"><i class="fas fa-user" style="color:#16a34a;"></i></span>
                        </a>
                        <button class="mobile-menu-btn" id="mobileMenuBtn"><i class="fas fa-bars"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Overlay -->
    <div class="search-box" id="searchBox">
        <div class="search-box-inner">
            <button class="search-close" id="searchClose" aria-label="Fechar busca"><i
                    class="fas fa-times"></i></button>
            <input type="text" placeholder="Pesquisar times, seleções, camisas..." class="search-input" id="searchInput"
                autocomplete="off">
            <div class="search-hint">
                <span>Sugestões:</span>
                <a href="camisas.html?category=clubs">Times</a>
                <a href="camisas.html?category=national">Seleções</a>
                <a href="camisas.html?category=retro">Retrô</a>
                <a href="camisas.html?discount=true">Ofertas</a>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <button class="mobile-menu-close" id="mobileMenuClose"><i class="fas fa-times"></i></button>
            <nav class="mobile-nav">
                <a href="camisas.html" class="mobile-nav-link">Novidades</a>
                <a href="camisas.html?category=clubs" class="mobile-nav-link">Times</a>
                <a href="camisas.html?category=national" class="mobile-nav-link">Seleções</a>
                <a href="camisas.html?category=retro" class="mobile-nav-link">Retrô</a>
                <a href="camisas.html?discount=true" class="mobile-nav-link">Ofertas</a>
            </nav>
        </div>
    </div>

    <!-- Profile Page -->
    <div class="container profile-page">
        <!-- Not Logged In State -->
        <div id="not-logged" style="display:none;" class="not-logged">
            <i class="far fa-user-circle"></i>
            <h2>Você não está logado</h2>
            <p>Faça login para acessar seu perfil e pedidos.</p>
            <a href="login.html" class="btn btn-primary">Fazer Login</a>
        </div>

        <!-- Profile Content -->
        <div id="profile-layout" class="profile-layout">
            <aside class="profile-sidebar">
                <nav class="profile-nav">
                    <a href="#dados" class="profile-nav-link active" onclick="setActiveNav(this)">Meus Dados</a>
                    <a href="#enderecos" class="profile-nav-link" onclick="setActiveNav(this)">Endereços</a>
                    <a href="#pedidos" class="profile-nav-link" onclick="setActiveNav(this)">Meus Pedidos</a>
                    <a href="#seguranca" class="profile-nav-link" onclick="setActiveNav(this)">Segurança</a>
                    <a href="#" class="profile-nav-link logout" id="logoutLink">Sair</a>
                </nav>
            </aside>

            <main class="profile-content">
                <div class="profile-header">
                    <h1 class="profile-title">Meu Perfil</h1>
                    <p class="profile-subtitle">Gerencie suas informações pessoais e preferências</p>
                </div>

                <!-- Personal Info -->
                <div class="profile-card" id="dados">
                    <div class="card-title">
                        <span>Informações Pessoais</span>
                        <button class="btn-edit">Editar</button>
                    </div>
                    <div class="info-grid" id="personal-info">
                        <div class="info-item">
                            <label>Nome Completo</label>
                            <p id="user-name">—</p>
                        </div>
                        <div class="info-item">
                            <label>E-mail</label>
                            <p id="user-email">—</p>
                        </div>
                        <div class="info-item">
                            <label>Telefone</label>
                            <p id="user-phone">—</p>
                        </div>
                        <div class="info-item">
                            <label>CPF</label>
                            <p id="user-cpf">—</p>
                        </div>
                    </div>
                </div>

                <!-- Addresses -->
                <div class="profile-card" id="enderecos">
                    <div class="card-title">
                        <span>Meus Endereços</span>
                        <button class="btn-edit">+ Adicionar Novo</button>
                    </div>
                    <div class="address-list" id="address-list">
                        <!-- populated by JS from localStorage/API -->
                        <div class="empty-addresses"
                            style="text-align:center; padding:2rem; color:var(--color-gray-300);">
                            <i class="fas fa-map-marker-alt"
                                style="font-size:2rem; margin-bottom:1rem; display:block; color:var(--color-gray-200);"></i>
                            <p style="font-size:14px;">Nenhum endereço cadastrado ainda.</p>
                            <p style="font-size:13px; margin-top:4px;">Clique em <strong>+ Adicionar Novo</strong> para
                                cadastrar.</p>
                        </div>
                    </div>
                </div>

                <!-- Orders -->
                <div class="profile-card" id="pedidos">
                    <div class="card-title">
                        <span>Pedidos Recentes</span>
                        <a href="meus-pedidos.html" class="btn-edit">Ver Todos</a>
                    </div>
                    <div id="orders-container">
                        <table class="order-table">
                            <thead>
                                <tr>
                                    <th>Pedido</th>
                                    <th>Data</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="orders-tbody">
                                <tr>
                                    <td colspan="5"
                                        style="text-align:center; color:var(--color-gray-400); padding: 2rem;">
                                        <i class="fas fa-spinner fa-spin" style="margin-right:.5rem;"></i>Carregando
                                        pedidos...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Security -->
                <div class="profile-card" id="seguranca">
                    <div class="card-title"><span>Segurança</span></div>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Senha</label>
                            <p>••••••••</p>
                        </div>
                        <div class="info-item">
                            <label>Autenticação em Duas Etapas</label>
                            <p id="user-2fa">Desativada</p>
                        </div>
                    </div>
                    <div style="margin-top: var(--spacing-lg); display: flex; gap: var(--spacing-md);">
                        <button class="btn btn-primary">Alterar Senha</button>
                        <button class="btn btn-secondary">Ativar 2FA</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <div class="footer-bottom-left">
                    <p><i class="fas fa-map-marker-alt"></i> Brasil</p>
                    <p>© 2024 FutWear, Inc. Todos os direitos reservados.</p>
                </div>
                <div class="footer-bottom-right">
                    <a href="#">Termos de Uso</a>
                    <a href="#">Política de Privacidade</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="header.js"></script>
    <script type="module">
        // Auth via localStorage (set by login.html)
        function getUser() {
            try { return JSON.parse(localStorage.getItem('user') || 'null'); } catch { return null; }
        }

        window.setActiveNav = function (link) {
            document.querySelectorAll('.profile-nav-link').forEach(l => l.classList.remove('active'));
            link.classList.add('active');
        };

        document.addEventListener('DOMContentLoaded', async () => {
            const user = getUser();

            if (user) {
                document.getElementById('user-name').textContent = user.name || user.displayName || '—';
                document.getElementById('user-email').textContent = user.email || '—';
                document.getElementById('user-phone').textContent = user.phone || '—';
                document.getElementById('user-cpf').textContent = user.cpf || '—';
            } else {
                // Not logged in — show fallback state
                const layout = document.getElementById('profile-layout');
                const notLogged = document.getElementById('not-logged');
                if (layout) layout.style.display = 'none';
                if (notLogged) notLogged.style.display = 'block';
                return;
            }

            // Logout
            document.getElementById('logoutLink').addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            });

            // Load orders from API
            const uid = user?.id || user?.uid;
            if (uid) {
                try {
                    const res = await fetch(`/api/orders?userId=${uid}`);
                    if (res.ok) {
                        const orders = await res.json();
                        const tbody = document.getElementById('orders-tbody');
                        if (orders && orders.length) {
                            tbody.innerHTML = orders.map(o => `
                                <tr>
                                    <td><strong>#${o.id || o.order_id}</strong></td>
                                    <td>${new Date(o.created_at || o.date).toLocaleDateString('pt-BR')}</td>
                                    <td>R$&nbsp;${Number(o.total).toFixed(2).replace('.', ',')}</td>
                                    <td><span class="status-badge status-${(o.status || 'pendente').toLowerCase()}">${o.status || 'Pendente'}</span></td>
                                    <td><a href="meus-pedidos.html?id=${o.id}" class="btn-edit">Detalhes</a></td>
                                </tr>`).join('');
                        } else {
                            document.getElementById('orders-tbody').innerHTML =
                                '<tr><td colspan="5" style="text-align:center;color:var(--color-gray-400);padding:2rem;">Nenhum pedido encontrado.</td></tr>';
                        }
                    } else {
                        throw new Error('API error');
                    }
                } catch {
                    document.getElementById('orders-tbody').innerHTML =
                        '<tr><td colspan="5" style="text-align:center;color:var(--color-gray-400);padding:2rem;">Nenhum pedido encontrado.</td></tr>';
                }
            } else {
                document.getElementById('orders-tbody').innerHTML =
                    '<tr><td colspan="5" style="text-align:center;color:var(--color-gray-400);padding:2rem;">Faça login para ver seus pedidos.</td></tr>';
            }
        });
    </script>
</body>

</html>