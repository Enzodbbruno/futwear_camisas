<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - FutWear</title>
    <meta name="description" content="Gerencie seu perfil na FutWear.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .profile-page {
            padding: var(--spacing-3xl) 0
        }

        .profile-layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            gap: var(--spacing-3xl)
        }

        .profile-sidebar {
            position: sticky;
            top: calc(var(--header-height) + var(--spacing-xl));
            height: fit-content
        }

        .profile-nav {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs)
        }

        .profile-nav-link {
            padding: var(--spacing-md);
            font-size: var(--font-size-base);
            font-weight: 500;
            color: var(--color-gray-400);
            border-left: 3px solid transparent;
            transition: all var(--transition-fast);
            cursor: pointer;
            display: block;
            text-decoration: none
        }

        .profile-nav-link:hover,
        .profile-nav-link.active {
            color: var(--color-black);
            border-left-color: var(--color-primary)
        }

        .profile-nav-link.logout {
            color: var(--color-accent);
            border-left-color: transparent
        }

        .profile-nav-link.logout:hover {
            border-left-color: var(--color-accent)
        }

        .profile-card {
            background: var(--color-white);
            border: 1px solid var(--color-gray-100);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            border-radius: 4px
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
            display: flex;
            justify-content: space-between;
            align-items: center
        }

        .btn-edit {
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            font-family: var(--font-primary);
            transition: color var(--transition-fast)
        }

        .btn-edit:hover {
            color: var(--color-black)
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg)
        }

        .info-item label {
            display: block;
            font-size: var(--font-size-sm);
            color: var(--color-gray-400);
            margin-bottom: var(--spacing-xs);
            text-transform: uppercase;
            letter-spacing: .5px
        }

        .info-item p {
            font-size: var(--font-size-base);
            font-weight: 500;
            min-height: 24px
        }

        .address-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md)
        }

        .address-item {
            padding: var(--spacing-md);
            border: 1px solid var(--color-gray-100);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-radius: 4px;
            gap: var(--spacing-md)
        }

        .address-badge {
            background: var(--color-primary);
            color: #fff;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: var(--spacing-xs);
            display: inline-block
        }

        .address-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0
        }

        .order-table {
            width: 100%;
            border-collapse: collapse
        }

        .order-table th {
            text-align: left;
            padding: var(--spacing-md);
            border-bottom: 2px solid var(--color-gray-100);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: .5px;
            color: var(--color-gray-400)
        }

        .order-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--color-gray-100);
            font-size: var(--font-size-sm)
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: var(--font-size-xs);
            font-weight: 500;
            text-transform: uppercase
        }

        .status-entregue {
            background: #d1fae5;
            color: #065f46
        }

        .status-enviado {
            background: #dbeafe;
            color: #1e40af
        }

        .status-pendente {
            background: #fef3c7;
            color: #92400e
        }

        .not-logged {
            text-align: center;
            padding: 80px var(--spacing-xl)
        }

        .not-logged i {
            font-size: 4rem;
            color: var(--color-gray-200);
            display: block;
            margin-bottom: var(--spacing-xl)
        }

        .not-logged h2 {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-md)
        }

        .not-logged p {
            color: var(--color-gray-400);
            margin-bottom: var(--spacing-2xl)
        }

        /* ---- Modal ---- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .6);
            backdrop-filter: blur(4px);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xl)
        }

        .modal-overlay.open {
            display: flex
        }

        .modal-box {
            background: #fff;
            width: 100%;
            max-width: 540px;
            padding: var(--spacing-2xl);
            border-radius: 8px;
            position: relative;
            animation: modalIn .2s ease;
            max-height: 90vh;
            overflow-y: auto
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: translateY(20px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .modal-box h2 {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-xl)
        }

        .modal-close {
            position: absolute;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            color: var(--color-gray-400);
            line-height: 1;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .modal-close:hover {
            color: var(--color-black)
        }

        .form-group {
            margin-bottom: var(--spacing-lg)
        }

        .form-group label {
            display: block;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--color-gray-400);
            text-transform: uppercase;
            letter-spacing: .5px;
            margin-bottom: var(--spacing-xs)
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 14px;
            border: 1.5px solid var(--color-gray-100);
            border-radius: 4px;
            font-size: var(--font-size-base);
            font-family: var(--font-primary);
            outline: none;
            transition: border-color var(--transition-fast);
            box-sizing: border-box
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--color-primary)
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md)
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--color-gray-100)
        }

        .avatar-circle {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 700;
            color: #fff;
            margin-bottom: var(--spacing-md)
        }

        @media(max-width:960px) {
            .profile-layout {
                grid-template-columns: 1fr
            }

            .profile-sidebar {
                position: static
            }

            .profile-nav {
                flex-direction: row;
                overflow-x: auto;
                flex-wrap: wrap
            }

            .info-grid {
                grid-template-columns: 1fr
            }
        }

        @media(max-width:640px) {

            .order-table th,
            .order-table td {
                padding: var(--spacing-sm);
                font-size: 12px
            }

            .form-row {
                grid-template-columns: 1fr
            }
        }
    </style>
</head>

<body>

    <!-- Announcement Bar -->
    <div class="announcement-bar">
        <span><span class="ann-dot"></span> Frete Gr&#225;tis em compras acima de 3 camisas! <span
                class="ann-dot"></span></span>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-top-content">
                    <a href="index.html" class="header-logo">FutWear</a>
                    <nav class="header-nav">
                        <a href="index.html" class="nav-link">In&#237;cio</a>
                        <a href="camisas.html" class="nav-link">Camisas</a>
                        <a href="camisas.html?category=national" class="nav-link">Sele&#231;&#245;es</a>
                        <a href="camisas.html?category=clubs" class="nav-link">Clubes</a>
                    </nav>
                    <div class="header-actions">
                        <button class="icon-btn" id="searchToggle" aria-label="Buscar"><i
                                class="fas fa-search"></i></button>
                        <a href="favoritos.html" class="icon-btn" aria-label="Favoritos">
                            <i class="far fa-heart"></i>
                            <span class="badge" id="wishlistBadge" style="display:none;">0</span>
                        </a>
                        <a href="carrinho.html" class="icon-btn" aria-label="Carrinho">
                            <i class="fas fa-shopping-bag"></i>
                            <span class="badge" id="cartBadge" style="display:none;">0</span>
                        </a>
                        <a href="perfil.html" class="icon-btn" aria-label="Perfil" id="profileLink">
                            <span id="authAvatar"><i class="far fa-user"></i></span>
                        </a>
                    </div>
                    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Menu"><i
                            class="fas fa-bars"></i></button>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Overlay -->
    <div class="search-box" id="searchBox">
        <div class="search-box-inner">
            <button class="search-close" id="searchClose" aria-label="Fechar"><i class="fas fa-times"></i></button>
            <input type="text" class="search-input" id="searchInput" placeholder="Buscar camisas, times..."
                autocomplete="off">
            <div class="search-hints">
                <span class="search-hint">Sele&#231;&#245;es</span>
                <span class="search-hint">Brasil</span>
                <span class="search-hint">Times Europeus</span>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <a href="index.html" class="header-logo">FutWear</a>
            <button class="icon-btn" id="mobileMenuClose"><i class="fas fa-times"></i></button>
        </div>
        <nav class="mobile-nav">
            <a href="index.html" class="mobile-nav-link">In&#237;cio</a>
            <a href="camisas.html" class="mobile-nav-link">Camisas</a>
            <a href="camisas.html?category=national" class="mobile-nav-link">Sele&#231;&#245;es</a>
            <a href="camisas.html?category=clubs" class="mobile-nav-link">Clubes</a>
            <a href="perfil.html" class="mobile-nav-link">Meu Perfil</a>
        </nav>
    </div>

    <!-- Profile -->
    <div class="profile-page">
        <div class="container">

            <!-- Not logged -->
            <div id="not-logged" class="not-logged" style="display:none;">
                <i class="far fa-user-circle"></i>
                <h2>Voc&#234; n&#227;o est&#225; logado</h2>
                <p>Fa&#231;a login para acessar seu perfil, pedidos e endere&#231;os.</p>
                <a href="login.html" class="btn btn-primary">Fazer Login</a>
            </div>

            <!-- Layout -->
            <div class="profile-layout" id="profile-layout">

                <!-- Sidebar -->
                <aside class="profile-sidebar">
                    <div class="avatar-circle" id="sidebarAvatar">U</div>
                    <p style="font-weight:700;margin-bottom:4px;" id="sidebar-name">-</p>
                    <p style="font-size:13px;color:var(--color-gray-400);margin-bottom:var(--spacing-xl);"
                        id="sidebar-email">-</p>
                    <nav class="profile-nav">
                        <a href="#info" class="profile-nav-link active" onclick="setActiveNav(this)">
                            <i class="fas fa-user" style="width:20px;margin-right:8px;"></i>Informa&#231;&#245;es
                            Pessoais
                        </a>
                        <a href="#enderecos" class="profile-nav-link" onclick="setActiveNav(this)">
                            <i class="fas fa-map-marker-alt" style="width:20px;margin-right:8px;"></i>Endere&#231;os
                        </a>
                        <a href="#pedidos" class="profile-nav-link" onclick="setActiveNav(this)">
                            <i class="fas fa-box" style="width:20px;margin-right:8px;"></i>Meus Pedidos
                        </a>
                        <a href="#seguranca" class="profile-nav-link" onclick="setActiveNav(this)">
                            <i class="fas fa-shield-alt" style="width:20px;margin-right:8px;"></i>Seguran&#231;a
                        </a>
                        <a href="#" class="profile-nav-link logout" id="logoutLink">
                            <i class="fas fa-sign-out-alt" style="width:20px;margin-right:8px;"></i>Sair
                        </a>
                    </nav>
                </aside>

                <!-- Content -->
                <main class="profile-content">
                    <div class="profile-header" style="margin-bottom:var(--spacing-2xl);">
                        <h1 style="font-size:var(--font-size-2xl);font-weight:700;margin-bottom:var(--spacing-sm);">Meu
                            Perfil</h1>
                        <p style="color:var(--color-gray-400);">Gerencie suas informa&#231;&#245;es, endere&#231;os e
                            pedidos.</p>
                    </div>

                    <!-- Personal Info card -->
                    <div class="profile-card" id="info">
                        <div class="card-title">
                            <span>Informa&#231;&#245;es Pessoais</span>
                            <button class="btn-edit" onclick="openEditModal()">Editar</button>
                        </div>
                        <div class="info-grid">
                            <div class="info-item"><label>Nome Completo</label>
                                <p id="user-name">-</p>
                            </div>
                            <div class="info-item"><label>E-mail</label>
                                <p id="user-email">-</p>
                            </div>
                            <div class="info-item"><label>Telefone / WhatsApp</label>
                                <p id="user-phone">-</p>
                            </div>
                            <div class="info-item"><label>CPF</label>
                                <p id="user-cpf">-</p>
                            </div>
                            <div class="info-item"><label>Data de Nascimento</label>
                                <p id="user-birth">-</p>
                            </div>
                            <div class="info-item"><label>G&#234;nero</label>
                                <p id="user-gender">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- Addresses card -->
                    <div class="profile-card" id="enderecos">
                        <div class="card-title">
                            <span>Meus Endere&#231;os</span>
                            <button class="btn-edit" onclick="openAddressModal()">+ Adicionar Novo</button>
                        </div>
                        <div class="address-list" id="address-list">
                            <div id="empty-address-msg"
                                style="text-align:center;padding:2rem;color:var(--color-gray-300);">
                                <i class="fas fa-map-marker-alt"
                                    style="font-size:2rem;margin-bottom:1rem;display:block;color:var(--color-gray-200);"></i>
                                <p style="font-size:14px;">Nenhum endere&#231;o cadastrado ainda.</p>
                                <p style="font-size:13px;margin-top:4px;">Clique em <strong>+ Adicionar Novo</strong>
                                    para cadastrar.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Orders card -->
                    <div class="profile-card" id="pedidos">
                        <div class="card-title">
                            <span>Pedidos Recentes</span>
                            <a href="#" class="btn-edit">Ver Todos</a>
                        </div>
                        <div style="overflow-x:auto;">
                            <table class="order-table">
                                <thead>
                                    <tr>
                                        <th>Pedido</th>
                                        <th>Data</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="orders-tbody">
                                    <tr>
                                        <td colspan="5"
                                            style="text-align:center;color:var(--color-gray-400);padding:2rem;">
                                            Nenhum pedido encontrado.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Security card -->
                    <div class="profile-card" id="seguranca">
                        <div class="card-title"><span>Seguran&#231;a</span></div>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Senha</label>
                                <p>&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;</p>
                            </div>
                            <div class="info-item">
                                <label>Autentica&#231;&#227;o em Duas Etapas</label>
                                <p>Desativada</p>
                            </div>
                        </div>
                        <div style="margin-top:var(--spacing-lg);display:flex;gap:var(--spacing-md);">
                            <button class="btn btn-primary">Alterar Senha</button>
                            <button class="btn btn-secondary">Ativar 2FA</button>
                        </div>
                    </div>
                </main>
            </div><!-- /profile-layout -->
        </div><!-- /container -->
    </div><!-- /profile-page -->

    <!-- ========= Modal: Editar Informacoes ========= -->
    <div class="modal-overlay" id="editModal">
        <div class="modal-box">
            <button class="modal-close" onclick="closeEditModal()">&times;</button>
            <h2>Editar Informa&#231;&#245;es</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="edit-name" placeholder="Seu nome completo">
                </div>
                <div class="form-group">
                    <label>E-mail</label>
                    <input type="email" id="edit-email" placeholder="seu@email.com">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Telefone / WhatsApp</label>
                    <input type="tel" id="edit-phone" placeholder="(11) 99999-9999" maxlength="15">
                </div>
                <div class="form-group">
                    <label>CPF</label>
                    <input type="text" id="edit-cpf" placeholder="000.000.000-00" maxlength="14">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Data de Nascimento</label>
                    <input type="date" id="edit-birth">
                </div>
                <div class="form-group">
                    <label>G&#234;nero</label>
                    <select id="edit-gender">
                        <option value="">Prefiro n&#227;o informar</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Feminino">Feminino</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="savePersonalInfo()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- ========= Modal: Endereco ========= -->
    <div class="modal-overlay" id="addressModal">
        <div class="modal-box">
            <button class="modal-close" onclick="closeAddressModal()">&times;</button>
            <h2 id="addressModalTitle">Novo Endere&#231;o</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>CEP</label>
                    <input type="text" id="addr-cep" placeholder="00000-000" maxlength="9"
                        oninput="autoFillCep(this.value)">
                </div>
                <div class="form-group">
                    <label>Apelido (ex: Casa, Trabalho)</label>
                    <input type="text" id="addr-label" placeholder="Casa">
                </div>
            </div>
            <div class="form-group">
                <label>Rua / Logradouro</label>
                <input type="text" id="addr-street" placeholder="Rua das Flores">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>N&#250;mero</label>
                    <input type="text" id="addr-number" placeholder="123">
                </div>
                <div class="form-group">
                    <label>Complemento</label>
                    <input type="text" id="addr-complement" placeholder="Apto 45 (opcional)">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Bairro</label>
                    <input type="text" id="addr-neighborhood" placeholder="Centro">
                </div>
                <div class="form-group">
                    <label>Cidade</label>
                    <input type="text" id="addr-city" placeholder="Sao Paulo">
                </div>
            </div>
            <div class="form-group" style="max-width:120px;">
                <label>Estado (UF)</label>
                <input type="text" id="addr-state" placeholder="SP" maxlength="2" style="text-transform:uppercase;">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeAddressModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveAddress()">Salvar Endere&#231;o</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <div class="footer-bottom-left">
                    <p><i class="fas fa-map-marker-alt"></i> Brasil</p>
                    <p>&copy; 2024 FutWear, Inc. Todos os direitos reservados.</p>
                </div>
                <div class="footer-bottom-right">
                    <a href="#">Termos de Uso</a>
                    <a href="#">Pol&#237;tica de Privacidade</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="header.js"></script>
    <script>
        /* ================================================================
           perfil.js  â€”  inline script for profile page
           ================================================================ */

        // ---- helpers ----
        function getUser() { try { return JSON.parse(localStorage.getItem('user') || 'null'); } catch (e) { return null; } }
        function saveUser(u) { localStorage.setItem('user', JSON.stringify(u)); }
        function getAddresses() { try { return JSON.parse(localStorage.getItem('addresses') || '[]'); } catch (e) { return []; } }
        function saveAddresses(a) { localStorage.setItem('addresses', JSON.stringify(a)); }

        // ---- nav active ----
        window.setActiveNav = function (link) {
            document.querySelectorAll('.profile-nav-link').forEach(function (l) { l.classList.remove('active'); });
            link.classList.add('active');
        };

        // ---- masks ----
        document.getElementById('edit-phone').addEventListener('input', function () {
            var v = this.value.replace(/\D/g, '').substring(0, 11);
            if (v.length > 7) v = '(' + v.substring(0, 2) + ') ' + v.substring(2, 7) + '-' + v.substring(7);
            else if (v.length > 2) v = '(' + v.substring(0, 2) + ') ' + v.substring(2);
            else if (v.length > 0) v = '(' + v;
            this.value = v;
        });

        document.getElementById('edit-cpf').addEventListener('input', function () {
            var v = this.value.replace(/\D/g, '').substring(0, 11);
            if (v.length > 9) v = v.substring(0, 3) + '.' + v.substring(3, 6) + '.' + v.substring(6, 9) + '-' + v.substring(9);
            else if (v.length > 6) v = v.substring(0, 3) + '.' + v.substring(3, 6) + '.' + v.substring(6);
            else if (v.length > 3) v = v.substring(0, 3) + '.' + v.substring(3);
            this.value = v;
        });

        document.getElementById('addr-cep').addEventListener('input', function () {
            var v = this.value.replace(/\D/g, '').substring(0, 8);
            if (v.length > 5) v = v.substring(0, 5) + '-' + v.substring(5);
            this.value = v;
        });

        // ---- ViaCEP auto-fill ----
        window.autoFillCep = function (cep) {
            var d = cep.replace(/\D/g, '');
            if (d.length !== 8) return;
            fetch('https://viacep.com.br/ws/' + d + '/json/')
                .then(function (r) { return r.json(); })
                .then(function (data) {
                    if (!data.erro) {
                        document.getElementById('addr-street').value = data.logradouro || '';
                        document.getElementById('addr-neighborhood').value = data.bairro || '';
                        document.getElementById('addr-city').value = data.localidade || '';
                        document.getElementById('addr-state').value = data.uf || '';
                        document.getElementById('addr-number').focus();
                    }
                }).catch(function () { });
        };

        // ---- Personal Info modal ----
        window.openEditModal = function () {
            var u = getUser() || {};
            document.getElementById('edit-name').value = u.name || u.displayName || '';
            document.getElementById('edit-email').value = u.email || '';
            document.getElementById('edit-phone').value = u.phone || '';
            document.getElementById('edit-cpf').value = u.cpf || '';
            document.getElementById('edit-birth').value = u.birth || '';
            document.getElementById('edit-gender').value = u.gender || '';
            document.getElementById('editModal').classList.add('open');
            document.body.style.overflow = 'hidden';
        };
        window.closeEditModal = function () {
            document.getElementById('editModal').classList.remove('open');
            document.body.style.overflow = '';
        };
        window.savePersonalInfo = function () {
            var u = getUser() || {};
            u.name = document.getElementById('edit-name').value.trim();
            u.email = document.getElementById('edit-email').value.trim();
            u.phone = document.getElementById('edit-phone').value.trim();
            u.cpf = document.getElementById('edit-cpf').value.trim();
            u.birth = document.getElementById('edit-birth').value;
            u.gender = document.getElementById('edit-gender').value;
            saveUser(u);
            renderPersonalInfo(u);
            closeEditModal();
            if (window.updateHeaderBadges) window.updateHeaderBadges();
        };

        // ---- Address modal ----
        var _editAddrIdx = -1;
        window.openAddressModal = function (idx) {
            _editAddrIdx = (idx !== undefined && idx !== null) ? idx : -1;
            var addrs = getAddresses();
            var addr = (_editAddrIdx >= 0) ? addrs[_editAddrIdx] : {};
            document.getElementById('addressModalTitle').textContent = (_editAddrIdx >= 0) ? 'Editar Endere\u00e7o' : 'Novo Endere\u00e7o';
            document.getElementById('addr-cep').value = addr.cep || '';
            document.getElementById('addr-label').value = addr.label || '';
            document.getElementById('addr-street').value = addr.street || '';
            document.getElementById('addr-number').value = addr.number || '';
            document.getElementById('addr-complement').value = addr.complement || '';
            document.getElementById('addr-neighborhood').value = addr.neighborhood || '';
            document.getElementById('addr-city').value = addr.city || '';
            document.getElementById('addr-state').value = addr.state || '';
            document.getElementById('addressModal').classList.add('open');
            document.body.style.overflow = 'hidden';
        };
        window.closeAddressModal = function () {
            document.getElementById('addressModal').classList.remove('open');
            document.body.style.overflow = '';
        };
        window.saveAddress = function () {
            var addrs = getAddresses();
            var addr = {
                cep: document.getElementById('addr-cep').value.trim(),
                label: document.getElementById('addr-label').value.trim() || 'Endere\u00e7o',
                street: document.getElementById('addr-street').value.trim(),
                number: document.getElementById('addr-number').value.trim(),
                complement: document.getElementById('addr-complement').value.trim(),
                neighborhood: document.getElementById('addr-neighborhood').value.trim(),
                city: document.getElementById('addr-city').value.trim(),
                state: document.getElementById('addr-state').value.trim().toUpperCase()
            };
            if (!addr.street || !addr.number || !addr.city) {
                alert('Preencha ao menos: Rua, N\u00famero e Cidade.');
                return;
            }
            if (_editAddrIdx >= 0) addrs[_editAddrIdx] = addr;
            else addrs.push(addr);
            saveAddresses(addrs);
            renderAddresses(addrs);
            closeAddressModal();
        };
        window.deleteAddress = function (idx) {
            if (!confirm('Remover este endere\u00e7o?')) return;
            var addrs = getAddresses();
            addrs.splice(idx, 1);
            saveAddresses(addrs);
            renderAddresses(addrs);
        };

        // ---- Render personal info ----
        function renderPersonalInfo(u) {
            function fmt(v) { return (v && v.toString().trim()) ? v : '-'; }
            document.getElementById('user-name').textContent = fmt(u.name || u.displayName);
            document.getElementById('user-email').textContent = fmt(u.email);
            document.getElementById('user-phone').textContent = fmt(u.phone);
            document.getElementById('user-cpf').textContent = fmt(u.cpf);
            document.getElementById('user-gender').textContent = fmt(u.gender);
            var birth = '-';
            if (u.birth) { var d = new Date(u.birth + 'T00:00:00'); if (!isNaN(d)) birth = d.toLocaleDateString('pt-BR'); }
            document.getElementById('user-birth').textContent = birth;
            var raw = u.name || u.displayName || u.email || 'U';
            var initials = raw.split(' ').map(function (w) { return w[0] || ''; }).join('').substring(0, 2).toUpperCase();
            document.getElementById('sidebarAvatar').textContent = initials;
            document.getElementById('sidebar-name').textContent = u.name || u.displayName || '-';
            document.getElementById('sidebar-email').textContent = u.email || '-';
        }

        // ---- Render addresses ----
        function renderAddresses(addrs) {
            var list = document.getElementById('address-list');
            var empty = document.getElementById('empty-address-msg');
            list.querySelectorAll('.address-item').forEach(function (el) { el.remove(); });
            if (!addrs || addrs.length === 0) { if (empty) empty.style.display = 'block'; return; }
            if (empty) empty.style.display = 'none';
            addrs.forEach(function (addr, idx) {
                var div = document.createElement('div');
                div.className = 'address-item';
                var line2 = [addr.neighborhood, addr.city, addr.state].filter(Boolean).join(', ');
                var comp = addr.complement ? ', ' + addr.complement : '';
                var cepStr = addr.cep ? ' &mdash; CEP ' + addr.cep : '';
                div.innerHTML =
                    '<div>' +
                    '<span class="address-badge">' + (addr.label || 'Endere\u00e7o') + '</span><br>' +
                    '<strong>' + addr.street + ', ' + addr.number + comp + '</strong><br>' +
                    '<span style="font-size:13px;color:var(--color-gray-400);">' + line2 + cepStr + '</span>' +
                    '</div>' +
                    '<div class="address-actions">' +
                    '<button class="btn-edit" onclick="openAddressModal(' + idx + ')">Editar</button>' +
                    '<button class="btn-edit" style="color:var(--color-accent);" onclick="deleteAddress(' + idx + ')">Remover</button>' +
                    '</div>';
                list.appendChild(div);
            });
        }

        // ---- Close modals on overlay click / Escape ----
        document.getElementById('editModal').addEventListener('click', function (e) { if (e.target === this) closeEditModal(); });
        document.getElementById('addressModal').addEventListener('click', function (e) { if (e.target === this) closeAddressModal(); });
        document.addEventListener('keydown', function (e) { if (e.key === 'Escape') { closeEditModal(); closeAddressModal(); } });

        // ---- Init ----
        document.addEventListener('DOMContentLoaded', function () {
            var user = getUser();
            if (!user) {
                document.getElementById('profile-layout').style.display = 'none';
                document.getElementById('not-logged').style.display = 'block';
                return;
            }
            renderPersonalInfo(user);
            renderAddresses(getAddresses());
            document.getElementById('logoutLink').addEventListener('click', function (e) {
                e.preventDefault();
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            });
            // try to load orders
            var uid = user.id || user.uid;
            var tbody = document.getElementById('orders-tbody');
            if (uid) {
                fetch('/api/orders?userId=' + uid)
                    .then(function (r) { if (!r.ok) throw new Error(); return r.json(); })
                    .then(function (orders) {
                        if (orders && orders.length) {
                            tbody.innerHTML = orders.map(function (o) {
                                return '<tr><td><strong>#' + (o.id || o.order_id) + '</strong></td>' +
                                    '<td>' + new Date(o.created_at || o.date).toLocaleDateString('pt-BR') + '</td>' +
                                    '<td>R$&nbsp;' + Number(o.total).toFixed(2).replace('.', ',') + '</td>' +
                                    '<td><span class="status-badge status-' + ((o.status || 'pendente').toLowerCase()) + '">' + (o.status || 'Pendente') + '</span></td>' +
                                    '<td><a href="#" class="btn-edit">Detalhes</a></td></tr>';
                            }).join('');
                        } else { throw new Error('empty'); }
                    })
                    .catch(function () {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--color-gray-400);padding:2rem;">Nenhum pedido encontrado.</td></tr>';
                    });
            }
        });
    </script>
</body>

</html>